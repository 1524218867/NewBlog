(function(){"use strict";var e={5555:function(e,t,s){var a=s(8451),i=s.n(a),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"fade"}},[e.isLoading?t("Loader",{attrs:{visible:e.isLoading}}):e._e()],1),t("transition",{attrs:{name:"fade"}},[t("router-view",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"view"})],1)],1)},o=[],n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"loader"},[t("div",[t("ul",[t("li",[t("svg",{attrs:{fill:"currentColor",viewBox:"0 0 90 120"}},[t("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),t("li",[t("svg",{attrs:{fill:"currentColor",viewBox:"0 0 90 120"}},[t("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),t("li",[t("svg",{attrs:{fill:"currentColor",viewBox:"0 0 90 120"}},[t("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),t("li",[t("svg",{attrs:{fill:"currentColor",viewBox:"0 0 90 120"}},[t("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),t("li",[t("svg",{attrs:{fill:"currentColor",viewBox:"0 0 90 120"}},[t("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),t("li",[t("svg",{attrs:{fill:"currentColor",viewBox:"0 0 90 120"}},[t("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])])])]),t("span",[e._v("Loading")])])},l=[],c={props:{visible:{type:Boolean,default:!1}}},d=c,u=s(1656),h=(0,u.A)(d,n,l,!1,null,"3eef93b4",null),g=h.exports,m=s(7222),p={data(){return{isLoading:!0}},components:{Loader:g},computed:{...(0,m.aH)(["hasVisitedHome"])},methods:{...(0,m.i0)(["markVisitedHome"]),initializeApp(){setTimeout((()=>{this.isLoading=!1,this.markVisitedHome()}),3e3)}},mounted(){this.initializeApp()}},v=p,f=(0,u.A)(v,r,o,!1,null,"71bbe550",null),C=f.exports,w=s(6648),y=s(2674);w["default"].use(m.Ay);const b=new m.Ay.Store({state:{user:{token:localStorage.getItem("token")||null,details:JSON.parse(localStorage.getItem("userDetails"))||{}},sharedData:null,hasVisitedHome:"true"===localStorage.getItem("hasVisitedHome"),favorites:[],userId:null,articleFrom:null},mutations:{setSharedData(e,t){e.sharedData=t},setArticleFrom(e,t){e.articleFrom=t},setUser(e,{token:t,details:s}){e.user.token=t,e.user.details=s,t?(localStorage.setItem("token",t),localStorage.setItem("userDetails",JSON.stringify(s))):(localStorage.removeItem("token"),localStorage.removeItem("userDetails"))},deleteUser(e){e.user={token:null,details:{}},localStorage.removeItem("token"),localStorage.removeItem("userDetails")},setHasVisitedHome(e,t){e.hasVisitedHome=t,localStorage.setItem("hasVisitedHome",t)},updateUsername(e,t){e.user.details.username=t},setFavorites(e,t){e.favorites=t}},actions:{updateSharedData({commit:e},t){e("setSharedData",t)},updateUser({commit:e},{token:t,details:s}){e("setUser",{token:t,details:s})},logout({commit:e}){e("deleteUser")},markVisitedHome({commit:e}){e("setHasVisitedHome",!0)},resetVisitedHome({commit:e}){e("setHasVisitedHome",!1)},async VuexloadFavorites({commit:e}){const t=localStorage.getItem("token");if(t)try{const s=await y.A.get("/api/user",{headers:{Authorization:`Bearer ${t}`}}),a=s.data._id,i=await y.A.get(`/api/favorites/${a}`),r=i.data;e("setFavorites",r)}catch(s){console.error("加载收藏失败:",s)}}},getters:{isLoggedIn(e){return!!e.user.token},getUser(e){return e.user.details},hasVisitedHome:e=>e.hasVisitedHome,getFavorites:e=>e.favorites,getUserId:e=>e.userId}});var A=b,I=(s(6099),s(6051)),k=s.n(I),_=s(79),S=s.n(_),U=function(){var e=this,t=e._self._c;return t("div",{staticClass:"PackageContent",on:{click:e.handleClickIndexContent}},[t("div",{staticClass:"header"},[t("div",{staticClass:"LogoAndMenu"},[t("div",{staticClass:"logo-menu-container"},[e._m(0),t("ul",{staticClass:"menu"},[t("li",{class:{active:"home"===e.activeSection}},[t("router-link",{attrs:{to:e.getPath(0)},nativeOn:{click:function(t){return e.setActive("home")}}},[t("span",[e._v("首页")])])],1),t("li",{class:{active:"discover"===e.activeSection}},[t("router-link",{attrs:{to:e.getPath(1)},nativeOn:{click:function(t){return e.setActive("discover")}}},[t("span",[e._v("发现")])])],1),t("li",{class:{active:"messages"===e.activeSection}},[t("router-link",{attrs:{to:"/messages"},nativeOn:{click:function(t){return e.setActive("messages")}}},[t("span",{staticClass:"message-nav-item"},[e._v(" 消息 "),e.unreadMessagesCount>0?t("span",{staticClass:"message-badge"},[e._v(e._s(e.unreadMessagesCount>99?"99+":e.unreadMessagesCount))]):e._e()])])],1),t("li",{class:{active:"my"===e.activeSection}},[t("router-link",{attrs:{to:e.getPath(3)},nativeOn:{click:function(t){return e.setActive("my")}}},[t("span",[e._v("我的")])])],1)])]),t("div",{staticClass:"right-container"},[t("ThemeToggle"),t("div",{staticClass:"InputContainer",class:{expanded:e.isSearchExpanded},on:{click:function(t){return t.stopPropagation(),e.toggleSearch.apply(null,arguments)}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.keyword,expression:"keyword"}],staticClass:"input",attrs:{placeholder:"搜索",id:"input",name:"text",type:"text"},domProps:{value:e.keyword},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchArticles.apply(null,arguments)},input:[function(t){t.target.composing||(e.keyword=t.target.value)},e.onInputChange],focus:e.highlightButton,blur:e.resetButton}}),t("label",{staticClass:"labelforsearch",attrs:{for:"input"},on:{click:function(t){return t.stopPropagation(),e.handleSearchClick.apply(null,arguments)}}},[t("svg",{staticClass:"searchIcon",attrs:{viewBox:"0 0 512 512"}},[t("path",{attrs:{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"}})])]),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.SouSuoContent,expression:"SouSuoContent"}]},[t("svg",{staticClass:"icon",attrs:{t:"1734760992680",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4142",width:"15",height:"15"},on:{click:e.CloseSearch}},[t("path",{attrs:{d:"M593.976284 490.054855l359.392196 359.549238a74.516756 74.516756 0 1 1-105.454166 105.454166L488.443597 595.587542l-359.470718 359.470717a74.438235 74.438235 0 0 1-105.532687 0 74.595278 74.595278 0 0 1 0-105.454166L382.910909 490.054855 23.440192 130.584137A74.595278 74.595278 0 0 1 128.972879 25.129971L488.443597 384.600688 847.914314 25.129971a74.595278 74.595278 0 1 1 105.454166 105.454166L593.976284 490.054855z",fill:"#2C2F46","p-id":"4143"}})]),e._l(e.SouSuoarticles,(function(s){return t("li",{key:s._id},[t("router-link",{staticClass:"search-result-item",attrs:{to:{name:"Article",params:{id:s._id}}}},[t("h3",{domProps:{innerHTML:e._s(s.title)}}),t("p",{domProps:{innerHTML:e._s(s.BriefIntroduction)}})])],1)}))],2)]),t("label",{staticClass:"popup",on:{click:function(e){e.preventDefault()}}},[t("div",{staticClass:"burger",attrs:{tabindex:"0"},on:{click:function(t){return t.preventDefault(),e.openPopup.apply(null,arguments)}}},[t("svg",{staticClass:"icon",attrs:{t:"1731742925320",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4265",width:"20",height:"200"}},[t("path",{attrs:{d:"M61.44 238.933333h901.12c27.306667 0 47.786667-20.48 47.786667-47.786666 0-27.306667-20.48-47.786667-47.786667-47.786667H61.44C34.133333 143.36 13.653333 163.84 13.653333 191.146667 13.653333 218.453333 34.133333 238.933333 61.44 238.933333z m901.12 225.28H61.44C34.133333 464.213333 13.653333 484.693333 13.653333 512s20.48 47.786667 47.786667 47.786667h901.12c27.306667 0 47.786667-20.48 47.786667-47.786667s-23.893333-47.786667-47.786667-47.786667z m0 320.853334H61.44c-27.306667 0-47.786667 20.48-47.786667 47.786666 0 27.306667 20.48 47.786667 47.786667 47.786667h901.12c27.306667 0 47.786667-20.48 47.786667-47.786667 0-27.306667-23.893333-47.786667-47.786667-47.786666z","p-id":"4266",fill:"#ffffff"}})])]),t("nav",{directives:[{name:"show",rawName:"v-show",value:e.isPopupVisible,expression:"isPopupVisible"}],staticClass:"popup-window",on:{click:function(t){return t.stopPropagation(),e.handlePopupClick.apply(null,arguments)}}},[t("ul",[t("li",[t("router-link",{attrs:{to:e.getPath(0)},nativeOn:{click:function(t){return e.setActive("home")}}},[t("button",{class:{active:"home"===e.activeSection}},[t("svg",{staticClass:"icon",attrs:{t:"1731745400798",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7089",width:"12",height:"12"}},[t("path",{attrs:{d:"M854 512.9c-20.9 0-37.7 16.9-37.7 37.7v240.6c0 85.6-69.6 155.2-155.2 155.2H362.9c-85.6 0-155.2-69.6-155.2-155.2V550.6c0-20.9-16.9-37.7-37.7-37.7s-37.7 16.9-37.7 37.7v240.6c0 127.2 103.5 230.7 230.7 230.7h298.1c127.2 0 230.7-103.5 230.7-230.7V550.6c0-20.8-16.9-37.7-37.8-37.7zM1012.2 430L596.7 35.9c-47.5-45.1-121.9-45.1-169.5 0L11.8 430c-15.1 14.3-15.8 38.2-1.4 53.4 14.4 15.1 38.2 15.8 53.4 1.4L479.2 90.6c18.4-17.4 47.2-17.4 65.5 0l415.5 394.1c7.3 6.9 16.6 10.4 26 10.4 10 0 20-4 27.4-11.8 14.4-15.1 13.8-39-1.4-53.3z","p-id":"7090"}})]),t("span",[e._v("首页")])])])],1),t("li",[t("router-link",{attrs:{to:e.getPath(1)},nativeOn:{click:function(t){return e.setActive("discover")}}},[t("button",{class:{active:"discover"===e.activeSection}},[t("svg",{staticClass:"icon",attrs:{t:"1731747976102",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"9138",width:"14",height:"14"}},[t("path",{attrs:{d:"M597.7 566.2m-352.5 0a352.5 352.5 0 1 0 705 0 352.5 352.5 0 1 0-705 0Z","p-id":"9139"}}),t("path",{attrs:{d:"M242.7 782.1c5.4 5.4 10.9 10.5 16.5 15.5 19.8-3.6 42.9-10.9 68.7-22.1-82.9-58.4-137.2-154.8-154.8-263.6 0-177.7 144.5-322.2 322.2-322.2 108.2 0 204 53.6 262.5 135.6 11-25.9 18-49.6 21-69.7-4.3-4.7-8.7-9.4-13.2-13.9-35.1-35.1-76-62.6-121.5-81.9-47.1-19.9-97.2-30-148.8-30-51.6 0-101.6 10.1-148.8 30-45.5 19.3-86.4 46.8-121.5 81.9-35.1 35.1-62.6 76-81.9 121.5-19.9 47.1-30 97.2-30 148.8 0 51.6 10.1 101.6 30 148.8 19.4 45.3 47 86.2 82 121.3zM867.5 405.5c-9.8 21.2-21.5 43-34.9 65.2 1.7 13.5 2.6 27.2 2.6 41.1C835.2 689.5 690.7 834 513 834c-13.6 0-26.9-0.9-40.1-2.5-23.2 14.1-46 26.4-68.1 36.7-4.6 2.1-9.1 4.1-13.6 6 39.1 13.1 80 19.8 121.8 19.8 51.6 0 101.6-10.1 148.8-30 45.5-19.3 86.4-46.8 121.5-81.9 35.1-35.1 62.6-76 81.9-121.5 19.9-47.1 30-97.2 30-148.8 0-42.3-6.8-83.7-20.3-123.2-2.3 5.6-4.8 11.2-7.4 16.9z","p-id":"9140"}}),t("path",{attrs:{d:"M849.3 174.2c-15.2-15.2-43.8-32.6-93.5-29.2-24.7 1.7-52.4 8.3-82.5 19.7 25 11.5 48.5 25.7 70.3 42.2 9.1-1.6 17.5-2.4 25-2.4 17.3 0 30.3 4.1 38.3 12 20.6 20.6 14.4 74.8-16.4 141.4-36.4 78.7-101.7 167.3-183.9 249.5C460.1 754.1 323.2 819.8 254 819.8c-17.3 0-30.3-4.1-38.3-12-11.9-11.9-15.1-35.3-8.9-67.1-16.3-21.8-30.2-45.2-41.6-70.1-12.2 31.5-19.2 60.4-21 86.1-3.5 49.7 13.9 78.3 29.2 93.5 13.9 13.9 38.9 29.6 81 29.6 4 0 8.2-0.1 12.5-0.4 33.5-2.3 72.3-13.6 115.4-33.5C467.3 806.6 562 737 649.1 650S805.7 468.2 845 383.2c19.9-43.1 31.2-81.9 33.5-115.4 3.5-49.8-13.9-78.4-29.2-93.6z",fill:"#000002","p-id":"9141"}}),t("path",{attrs:{d:"M491.022975 310.036021a30 30 0 1 0 42.425667-42.427147 30 30 0 1 0-42.425667 42.427147Z",fill:"#000002","p-id":"9142"}}),t("path",{attrs:{d:"M267.537509 533.397692a30 30 0 1 0 42.425666-42.427148 30 30 0 1 0-42.425666 42.427148Z",fill:"#000002","p-id":"9143"}}),t("path",{attrs:{d:"M477.9 477.3c-7.6 7.6-16.4 13.4-26.2 17.4-9.5 3.9-19.5 5.8-29.8 5.8s-20.3-2-29.8-5.8c-7.7-3.1-11.4-11.9-8.3-19.5 3.1-7.7 11.9-11.4 19.5-8.3 5.9 2.4 12.1 3.6 18.5 3.6s12.6-1.2 18.5-3.6c6.1-2.5 11.6-6.1 16.3-10.8 4.7-4.7 8.3-10.2 10.8-16.3 2.4-5.9 3.6-12.1 3.6-18.5s-1.2-12.6-3.6-18.5c-3.1-7.7 0.6-16.4 8.3-19.5 7.7-3.1 16.4 0.6 19.5 8.3 3.9 9.5 5.8 19.5 5.8 29.8s-2 20.3-5.8 29.8c-3.9 9.7-9.7 18.5-17.3 26.1z",fill:"#000002","p-id":"9144"}})]),t("span",[e._v("发现")])])])],1),t("li",[t("router-link",{attrs:{to:"/messages"},nativeOn:{click:function(t){return e.setActive("messages")}}},[t("button",{class:{active:"messages"===e.activeSection}},[t("svg",{attrs:{viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M17 3.33782C15.5291 2.48697 13.8214 2 12 2C6.47715 2 2 6.47715 2 12C2 13.5997 2.37562 15.1116 3.04346 16.4525C3.22094 16.8088 3.28001 17.2161 3.17712 17.6006L2.58151 19.8267C2.32295 20.793 3.20701 21.677 4.17335 21.4185L6.39939 20.8229C6.78393 20.72 7.19121 20.7791 7.54753 20.9565C8.88837 21.6244 10.4003 22 12 22C17.5228 22 22 17.5228 22 12C22 10.1786 21.513 8.47087 20.6622 7",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}}),t("path",{attrs:{d:"M8 12H8.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}}),t("path",{attrs:{d:"M12 12H12.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}}),t("path",{attrs:{d:"M16 12H16.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})]),t("span",{staticClass:"mobile-message-item"},[e._v(" 消息 "),e.unreadMessagesCount>0?t("span",{staticClass:"mobile-message-badge"},[e._v(e._s(e.unreadMessagesCount>99?"99+":e.unreadMessagesCount))]):e._e()])])])],1),e.isDisabled?t("li",[t("router-link",{attrs:{to:e.getPath(4)},nativeOn:{click:function(t){return e.setActive("login")}}},[t("button",{class:{active:"login"===e.activeSection}},[t("svg",{staticClass:"icon",attrs:{t:"1733543439950",viewBox:"0 0 1084 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"8145",width:"14",height:"14"}},[t("path",{attrs:{d:"M655.380078 298.927686a34.354196 34.354196 0 0 1 0-48.268549 33.731765 33.731765 0 0 1 47.947295 0l233.773176 235.52c7.027451 7.087686 10.039216 16.524549 9.59749 25.820863 0.461804 9.296314-2.549961 18.733176-9.59749 25.86102l-233.773176 235.52a33.731765 33.731765 0 0 1-47.947295 0 34.374275 34.374275 0 0 1 0-48.288628L833.054118 546.133333H33.872314C15.199373 546.133333 0 530.873725 0 512c0-18.833569 15.179294-34.133333 33.872314-34.133333H833.054118l-177.653961-178.938981zM948.725961 1024H271.058824c-74.852392 0-135.529412-61.138824-135.529412-136.533333v-136.533334h67.764706v136.533334c0 37.707294 30.33851 68.266667 67.764706 68.266666h677.647058c37.426196 0 67.764706-30.579451 67.764706-68.266666V136.533333c0-37.707294-30.33851-68.266667-67.764706-68.266666H271.058824c-37.426196 0-67.764706 30.559373-67.764706 68.266666v136.533334H135.529412V136.533333C135.529412 61.138824 196.206431 0 271.058824 0h677.647058C1023.558275 0 1084.235294 61.138824 1084.235294 136.533333v750.933334c0 75.39451-60.67702 136.533333-135.529412 136.533333z","p-id":"8146"}})]),t("span",[e._v("登录")])])])],1):t("li",[t("router-link",{attrs:{to:e.getPath(3)},nativeOn:{click:function(t){return e.setActive("my")}}},[t("button",{class:{active:"my"===e.activeSection}},[t("svg",{staticClass:"icon",attrs:{t:"1731814009258",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2391",width:"14",height:"14"}},[t("path",{attrs:{d:"M512.451579 545.507144c-148.479097 0-269.140942-120.842477-269.140942-269.140942S363.972482 7.22526 512.451579 7.22526s269.140942 120.842477 269.140942 269.140942-120.661845 269.140942-269.140942 269.140942z m0-477.589698c-114.881637 0-208.448756 93.567119-208.448757 208.448756s93.567119 208.448756 208.448757 208.448757S720.900335 391.247839 720.900335 276.366202 627.333216 67.917446 512.451579 67.917446zM896.654789 1016.232845H128.248368c-47.506086 0-85.980596-38.655142-85.980596-85.980596v-58.163344l1.806315-5.057683c57.802081-160.220145 250.355265-272.211678 468.377492-272.211677S923.026989 706.811078 980.82907 867.031222l1.806315 5.057683V930.252249c0 47.506086-38.655142 85.980596-85.980596 85.980596zM103.140589 882.926795V930.252249c0 13.908626 11.379785 25.288411 25.288411 25.288411h768.225789c13.908626 0 25.288411-11.379785 25.288411-25.288411v-47.506086C870.463221 748.717587 703.017816 655.692362 512.451579 655.692362S154.439936 748.717587 103.140589 882.926795z","p-id":"2392"}})]),t("span",[e._v("我的")])])])],1)])])])],1)])]),t("div",{staticClass:"main-container"},[t("div",{staticClass:"content-wrapper"},[t("router-view",{key:e.$route.fullPath,attrs:{getImageUrl:e.getImageUrl,lastViewedArticleZi:e.lastViewedArticle},on:{themeChanged:e.updateTheme,"call-parent":e.logout}})],1)])])},x=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"logo"},[t("img",{attrs:{src:s(3153),alt:"Logo"}}),t("span",[e._v("云端轻语")])])}],L=(s(6948),function(){var e=this,t=e._self._c;return t("div",{staticClass:"theme-toggle",attrs:{title:"light"===e.currentTheme?"切换到暗色模式":"切换到亮色模式"},on:{click:e.toggleTheme}},["light"===e.currentTheme?t("svg",{staticClass:"icon",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[t("circle",{attrs:{cx:"12",cy:"12",r:"5"}}),t("line",{attrs:{x1:"12",y1:"1",x2:"12",y2:"3"}}),t("line",{attrs:{x1:"12",y1:"21",x2:"12",y2:"23"}}),t("line",{attrs:{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}}),t("line",{attrs:{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}}),t("line",{attrs:{x1:"1",y1:"12",x2:"3",y2:"12"}}),t("line",{attrs:{x1:"21",y1:"12",x2:"23",y2:"12"}}),t("line",{attrs:{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}}),t("line",{attrs:{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"}})]):t("svg",{staticClass:"icon",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[t("path",{attrs:{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}})])])}),F=[];const D={light:{"--primary-color":"#3498db","--secondary-background":"#f8f9ff","--active-background":"#f7f7f8","--background-color":"#ffffff","--border-color":"#f0f1fb","--text-color":"#000000","--text-color-secondary":"#666666","--button-color":"#1988fa","--button-color-rgb":"25, 136, 250","--card-background":"#f5f5f5","--gradient-primary":"linear-gradient(to right, #1988fa 0%, #33c4f9 50%, #00f2fe 100%)","--shadow-color":"rgba(0, 0, 0, 0.1)","--shadow-color-strong":"rgba(0, 0, 0, 0.15)"},dark:{"--primary-color":"#808080","--secondary-background":"#1a1a1a","--active-background":"#2a2a2a","--background-color":"#121212","--border-color":"#333333","--text-color":"#e0e0e0","--text-color-secondary":"#999999","--button-color":"#666666","--button-color-rgb":"102, 102, 102","--card-background":"#1f1f1f","--gradient-primary":"linear-gradient(to right, #4a4a4a 0%, #666666 50%, #808080 100%)","--shadow-color":"rgba(255, 255, 255, 0.05)","--shadow-color-strong":"rgba(255, 255, 255, 0.08)"}};class ${constructor(){if(!D||!D.light||!D.dark)throw new Error("主题配置未正确初始化");this.themes=D;const e=localStorage.getItem("theme"),t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.currentTheme=e||(t?"dark":"light"),this.initTheme(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{localStorage.getItem("theme")||(this.currentTheme=e.matches?"dark":"light",this.applyTheme(this.currentTheme))}))}initTheme(){this.applyTheme(this.currentTheme)}toggleTheme(){return this.currentTheme="light"===this.currentTheme?"dark":"light",this.applyTheme(this.currentTheme),localStorage.setItem("theme",this.currentTheme),this.currentTheme}applyTheme(e){const t=D[e];for(const[s,a]of Object.entries(t))document.documentElement.style.setProperty(s,a)}getCurrentTheme(){return this.currentTheme}}var P=new $,M={name:"ThemeToggle",data(){return{currentTheme:P.getCurrentTheme()}},methods:{toggleTheme(){this.currentTheme=P.toggleTheme()}},mounted(){this.currentTheme=P.getCurrentTheme()}},T=M,E=(0,u.A)(T,L,F,!1,null,"46914740",null),H=E.exports,B=function(){var e=this,t=e._self._c;return t("div",{staticClass:"footer"},[t("div",{staticClass:"footer-content"},[t("div",{staticClass:"footer-info"},[e._m(0),t("p",[e._v("© "+e._s(e.currentYear)+" 云端轻语 - 版权所有")]),e._m(1)])])])},V=[function(){var e=this,t=e._self._c;return t("p",[e._v("如有问题请联系站长："),t("a",{attrs:{href:"mailto:admin@cloudwhisper.com"}},[e._v("18569923150@163.com")])])},function(){var e=this,t=e._self._c;return t("p",[t("a",{attrs:{href:"https://beian.miit.gov.cn/",target:"_blank",rel:"noopener noreferrer"}},[e._v("豫ICP备2024101096号")])])}],z={name:"Footer",computed:{currentYear(){return(new Date).getFullYear()}}},N=z,R=(0,u.A)(N,B,V,!1,null,"78218534",null),j=R.exports,O={components:{ThemeToggle:H,Footer:j},data(){return{articles:[],filteredArticles:[],latestArticle:{},isDisabled:!1,activeSection:"home",LoginActive:null,currentTheme:"light",themes:{light:{"--primary-color":"#3498db","--secondary-background":"#f8f9ff","--active-background":"#f7f7f8","--background-color":"#ffffff","--border-color":"#f0f1fb","--text-color":"#000000","--button-color":"#1988fa","--card-background":"#f5f5f5","--gradient-primary":"linear-gradient(to right, #1988fa 0%, #33c4f9 50%, #00f2fe 100%)"},dark:{"--primary-color":"#808080","--secondary-background":"#1a1a1a","--active-background":"#2a2a2a","--background-color":"#121212","--border-color":"#333333","--text-color":"#e0e0e0","--button-color":"#666666","--card-background":"#1f1f1f","--gradient-primary":"linear-gradient(to right, #4a4a4a 0%, #666666 50%, #808080 100%)"}},DisplayContinueReading:!1,viewedArticles:[],lastViewedArticle:null,noArticlesMessage:!1,scrollPosition:0,maxScrollPosition:0,JingDuTiao:0,isPopupVisible:!1,keyword:"",isButtonHighlighted:!1,SouSuoarticles:[],SouSuoContent:!1,isSearchExpanded:!1,unreadMessagesCount:0,checkMessagesInterval:null}},computed:{...(0,m.L8)(["isLoggedIn","getUser"]),...(0,m.aH)(["favorites"]),isPublishPage(){return"/Index/Content"===this.$route.path},isUserPage(){return"/Index/User"===this.$route.path}},watch:{$route:{handler(e){e.path.includes("/Index/Home")?this.activeSection="home":e.path.includes("/Index/Discover")?this.activeSection="discover":e.path.includes("/Index/My")&&(this.activeSection="my")},immediate:!0}},created(){this.activeSection=this.getActiveSection(),this.isDisabled=!this.isLoggedIn,"dark"===localStorage.getItem("theme")?this.updateTheme("dark"):this.updateTheme("light"),this.$root.$on("update-unread-count",(e=>{console.log("收到未读消息数更新:",e),this.unreadMessagesCount=e})),this.startCheckingMessages()},methods:{...(0,m.i0)(["logout","VuexloadFavorites"]),getActiveSection(){const e=this.$route.path;return e.includes("/Index/Home")?"home":e.includes("/Index/Discover")?"discover":e.includes("/Index/My")?"my":"home"},goToRegister(){this.$router.push("/Login")},openPopup(e){e.stopPropagation(),this.isPopupVisible=!this.isPopupVisible},handleClickIndexContent(e){const t=e.target.closest(".popup-window");!t&&this.isPopupVisible&&(this.isPopupVisible=!1)},handlePopupClick(e){e.stopPropagation()},async logout(){try{await this.$store.dispatch("logout"),localStorage.removeItem("token"),_.Notification.success({title:"退出登录成功",message:"您已成功退出登录。",duration:3e3}),this.$router.push("/Login")}catch(e){_.Notification.error({title:"退出登录失败",message:"退出登录过程中出现错误，请稍后重试。",duration:3e3}),console.error("Error:",e)}},getImageUrl(e){return`http://localhost:3000/uploads/${e}`},async fetchArticles(){try{const e=await y.A.get("/api/articles");this.articles=e.data,this.filteredArticles=this.articles,this.latestArticle=this.articles.length>0?this.articles[this.articles.length-1]:{}}catch(e){console.error("Error fetching articles:",e)}},async fetchViewedArticles(){if(null!=localStorage.getItem("token")){this.DisplayContinueReading=!0;try{const e=await y.A.get("/api/user/viewed-articles",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(this.viewedArticles=e.data,0===this.viewedArticles.length)return this.noArticlesMessage=!0,void(this.lastViewedArticle=null);const t=[...this.viewedArticles].sort(((e,t)=>new Date(t.lastViewedAt)-new Date(e.lastViewedAt))),s=t.filter((e=>this.calculateProgress(e.scrollPosition,e.maxScrollPosition)<100));s.length>0?(this.lastViewedArticle=s[0],this.noArticlesMessage=!1):(this.lastViewedArticle=t[0],this.noArticlesMessage=!1),this.lastViewedArticle?this.JingDuTiao=this.calculateProgress(this.lastViewedArticle.scrollPosition,this.lastViewedArticle.maxScrollPosition):this.JingDuTiao=0}catch(e){console.error("Error fetching viewed articles:",e),this.noArticlesMessage=!0}}},calculateProgress(e,t){if(0===t)return 0;const s=e/t*100;return Math.min(s,100)},setActive(e){this.activeSection=e,"messages"===e&&(this.unreadMessagesCount=0)},LoginActiveCLick(e){this.LoginActive=e},getPath(e){const t={0:"/Index/Home",1:"/Index/Discover",3:"/Index/My",4:"/Login"};return t[e]||"/Index/Home"},setActiveSection(){if(this.$route.matched.length>0)return;const e=this.activeSection;let t="";switch(e){case"home":t="/Index/Home";break;case"discover":t="/Index/Discover";break;case"my":t="/Index/My";break;default:t="/Index/Home"}this.$router.push(t)},toggleTheme(){this.currentTheme="light"===this.currentTheme?"dark":"light",this.updateTheme(this.currentTheme),localStorage.setItem("theme",this.currentTheme)},updateTheme(e){this.currentTheme=e;const t=this.themes[e];for(const s in t)document.documentElement.style.setProperty(s,t[s]);localStorage.setItem("theme",e)},Indexpublish(){this.$notify({title:"警告",message:"请先登录",type:"warning"})},async searchArticles(){if(!this.keyword)return this.message="请输入关键词进行搜索",void _.Notification.info({title:"注意",message:"请输入关键词进行搜索",duration:3e3});try{const e=await fetch(`/api/articles/search?keyword=${encodeURIComponent(this.keyword)}`);if(e.ok){const t=await e.json();t.length>0?(this.SouSuoarticles=t.map((e=>({...e,title:this.highlightKeyword(e.title),BriefIntroduction:this.highlightKeyword(e.BriefIntroduction)}))),this.SouSuoContent=!0,this.message=""):(this.message="没有找到相关的文章",this.SouSuoContent=!1)}else 404===e.status?(this.message="没有找到相关的文章",this.SouSuoContent=!1,_.Notification.error({title:"提示",message:"没有找到相关的文章",duration:3e3})):(this.message="服务器出错，请稍后再试",_.Notification.error({title:"错误",message:"服务器出错，请稍后再试",duration:3e3}))}catch(e){console.error(e),this.message="网络错误，请检查网络连接",_.Notification.error({title:"错误",message:"网络错误，请检查网络连接",duration:3e3})}},highlightKeyword(e){if(!this.keyword||!e)return e;const t=new RegExp(this.keyword,"gi");return e.replace(t,(e=>`<span class="highlight">${e}</span>`))},onInputChange(){this.keyword.trim()||(this.SouSuoarticles=[],this.message="请输入关键词进行搜索")},highlightButton(){this.isButtonHighlighted=!0},resetButton(){this.isButtonHighlighted=!1},CloseSearch(){this.SouSuoContent=!1},handleSearchClick(e){window.innerWidth<=768?(this.keyword.trim()&&this.searchArticles(),this.isSearchExpanded=!this.isSearchExpanded,this.isSearchExpanded&&this.$nextTick((()=>{const e=this.$el.querySelector(".input");e&&e.focus()}))):this.searchArticles()},toggleSearch(e){e.target.closest(".labelforsearch")||window.innerWidth<=768&&(this.isSearchExpanded||(this.isSearchExpanded=!0,this.$nextTick((()=>{const e=this.$el.querySelector(".input");e&&e.focus()}))))},handleDocumentClick(e){if(window.innerWidth<=768){const t=this.$el.querySelector(".InputContainer");t&&!t.contains(e.target)&&(this.isSearchExpanded=!1)}},startCheckingMessages(){this.checkUnreadMessages(),this.checkMessagesInterval=setInterval((()=>{this.checkUnreadMessages()}),6e4)},async checkUnreadMessages(){if(this.isLoggedIn)try{const e=localStorage.getItem("token");if(!e)return;const t=await y.A.get("/api/conversations/unread-count",{headers:{Authorization:`Bearer ${e}`}});t.data&&"number"===typeof t.data.unreadCount&&(this.unreadMessagesCount=t.data.unreadCount,console.log("未读消息数量:",this.unreadMessagesCount))}catch(e){console.error("获取未读消息数失败:",e)}}},mounted(){this.isDisabled=!localStorage.getItem("token");const e=localStorage.getItem("theme")||"light";this.updateTheme(e),this.VuexloadFavorites(),this.fetchArticles(),this.setActiveSection(),this.fetchViewedArticles(),document.addEventListener("click",this.handleDocumentClick)},beforeDestroy(){document.removeEventListener("click",this.handleDocumentClick),this.checkMessagesInterval&&clearInterval(this.checkMessagesInterval)}},W=O,q=(0,u.A)(W,U,x,!1,null,"c1127ec6",null),K=q.exports,Q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"theme-toggle-container"},[t("ThemeToggle")],1),e.isLoading?e._e():t("div",{staticClass:"carousel-container"},[t("Carousel",{attrs:{"carousel-items":e.carouselItems}})],1),t("div",{staticClass:"card-container"},[t("transition",{attrs:{name:"fade"}},[e.isLoginForm?t("div",{staticClass:"card"},[t("div",{staticClass:"card-inner"},[t("div",{staticClass:"card-front"},[t("LoginForm",{attrs:{form:e.form,toggleForm:e.toggleForm}})],1)])]):e._e()]),t("transition",{attrs:{name:"fade"}},[e.isLoginForm?e._e():t("div",{staticClass:"card"},[t("div",{staticClass:"card-inner"},[t("div",{staticClass:"card-back"},[t("RegisterForm",{attrs:{form:e.form,toggleForm:e.toggleForm}})],1)])])])],1)])},J=[],X=function(){var e=this,t=e._self._c;return t("div",{staticClass:"swiper-container"},[t("div",{staticClass:"swiper-wrapper"},e._l(e.carouselItems,(function(s){return t("div",{key:s.id,staticClass:"swiper-slide"},[t("img",{staticClass:"slide-image",attrs:{src:s.src,alt:"Slide Image"}}),t("div",{staticClass:"quote"},[e._v(e._s(s.quote))]),t("div",{staticClass:"author"},[e._v(e._s(s.author))])])})),0),t("div",{staticClass:"swiper-pagination"})])},G=[],Y=s(8961),Z={props:{carouselItems:{type:Array,required:!0}},mounted(){new Y.A(".swiper-container",{autoplay:{delay:3e3,disableOnInteraction:!1},loop:!0,pagination:{el:".swiper-pagination",clickable:!0,renderBullet:(e,t)=>`<span class="${t} custom-bullet"></span>`},allowTouchMove:!1})}},ee=Z,te=(0,u.A)(ee,X,G,!1,null,"d497ab64",null),se=te.exports,ae=function(){var e=this,t=e._self._c;return t("div",{staticClass:"form-container"},[t("h2",[e._v("Sign in")]),t("el-form",{ref:"loginForm",staticClass:"ElFrom",attrs:{model:e.form,rules:e.rules},on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("el-form-item",{attrs:{prop:"email"}},[t("el-input",{staticClass:"ElInp",attrs:{placeholder:"邮箱地址","prefix-icon":"el-icon-message"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{staticClass:"ElInp",attrs:{type:"password",placeholder:"密码","prefix-icon":"el-icon-lock","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-button",{staticClass:"BtnAft",attrs:{type:"primary",loading:e.loading,block:""},on:{click:function(t){return e.submitForm("loginForm")}}},[e._v("登录")])],1),e._m(0),t("div",{staticClass:"signin-link"},[t("small",[e._v(" 没有账户? "),t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleForm.apply(null,arguments)}}},[e._v("创建账户")])])])],1)},ie=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"divider"},[t("span",{staticClass:"line"}),t("span",{staticClass:"text"},[e._v("or")]),t("span",{staticClass:"line"})])}],re={props:{toggleForm:{type:Function,required:!0}},data(){return{form:{email:"",password:""},rules:{email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}]},loading:!1,theme:localStorage.getItem("theme")||"light"}},methods:{...(0,m.i0)(["updateUser"]),submitForm(e){this.$refs[e].validate((async e=>{if(!e)return!1;this.loading=!0;try{const e={email:this.form.email,password:this.form.password},t=await y.A.post("/api/auth/login",e,{headers:{"Content-Type":"application/json"}});_.Notification.success({title:"登录成功",message:"您已成功登录。",duration:3e3});const s=t.data.token;console.log("登陆后返回用户信息",t.data);const a=t.data.user;localStorage.setItem("token",s),console.log("登录处获得了信息",a),this.$store.dispatch("updateUser",{token:s,details:a}),y.A.get("/api/users",{headers:{Authorization:`Bearer ${s}`}}).then((e=>{console.log("登录处获得了信息",e);const t=e.data;this.$store.dispatch("updateUser",{token:s,details:t})})).catch((e=>{console.error("Get user details error:",e)})),this.$router.push("/Index")}catch(t){if(this.loading=!1,t.response&&t.response.data){const e=t.response.data.msg||"登录失败";_.Notification.error({title:"登录失败",message:e,duration:3e3})}else _.Notification.error({title:"登录失败",message:"登录过程中出现错误，请稍后重试。",duration:3e3})}}))}},mounted(){this.theme=localStorage.getItem("theme")||"light"}},oe=re,ne=(0,u.A)(oe,ae,ie,!1,null,"d0d38dd8",null),le=ne.exports,ce=function(){var e=this,t=e._self._c;return t("div",{staticClass:"form-container2"},[t("h2",[e._v("Welcome back!")]),t("el-form",{ref:"registerForm",staticClass:"ElFrom",attrs:{model:e.form,rules:e.rules},on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("el-form-item",{attrs:{prop:"name"}},[t("el-input",{staticClass:"ElInp",attrs:{placeholder:"用户名","prefix-icon":"el-icon-user"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{prop:"email"}},[t("el-input",{staticClass:"ElInp",attrs:{placeholder:"邮箱","prefix-icon":"el-icon-message"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{staticClass:"ElInp",attrs:{type:"password",placeholder:"密码","prefix-icon":"el-icon-lock","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{prop:"confirmPassword"}},[t("el-input",{staticClass:"ElInp",attrs:{type:"password",placeholder:"再次输入密码","prefix-icon":"el-icon-lock","show-password":""},model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],1),t("el-form-item",{staticClass:"verification-code-item",attrs:{prop:"verificationCode"}},[t("el-input",{staticClass:"ElInp verification-input",attrs:{placeholder:"验证码","prefix-icon":"el-icon-message"},model:{value:e.form.verificationCode,callback:function(t){e.$set(e.form,"verificationCode",t)},expression:"form.verificationCode"}},[t("template",{slot:"append"},[t("el-button",{attrs:{disabled:e.countdown>0},on:{click:e.sendVerificationCode}},[e._v(e._s(e.countdown>0?`${e.countdown}s后重试`:"获取验证码"))])],1)],2)],1),t("el-button",{staticClass:"BtnAft",attrs:{type:"primary",loading:e.loading,block:""},on:{click:function(t){return e.submitForm("registerForm")}}},[e._v("创建帐户")])],1),e._m(0),t("div",{staticClass:"signin-link"},[t("small",[e._v(" 已经有账户了吗? "),t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleForm.apply(null,arguments)}}},[e._v("登陆")])])])],1)},de=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"divider"},[t("span",{staticClass:"line"}),t("span",{staticClass:"text"},[e._v("or")]),t("span",{staticClass:"line"})])}],ue={props:{toggleForm:{type:Function,required:!0},theme:{type:String,default:""}},data(){return{form:{name:"",email:"",password:"",confirmPassword:"",verificationCode:""},rules:{name:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(e,t,s)=>{t!==this.form.password?s(new Error("两次输入密码不一致")):s()},trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码长度必须为6位",trigger:"blur"}]},loading:!1,currentTheme:"",countdown:0}},methods:{async sendVerificationCode(){try{await this.$refs.registerForm.validateField("email"),this.countdown=60;const e=Date.now(),t=setInterval((()=>{const s=Math.floor((Date.now()-e)/1e3);this.countdown=Math.max(60-s,0),0===this.countdown&&clearInterval(t)}),1e3);_.Notification.info({title:"发送中",message:"验证码发送中，请稍候查收",duration:3e3}),await y.A.post("/api/auth/send-verification-code",{email:this.form.email}),_.Notification.success({title:"发送成功",message:"验证码已发送到您的邮箱",duration:3e3})}catch(e){_.Notification.error({title:"发送失败",message:e.response?.data?.message||"验证码发送失败，请稍后重试",duration:3e3})}},submitForm(e){this.$refs[e].validate((async e=>{if(!e)return!1;this.loading=!0;try{const e={username:this.form.name,email:this.form.email,password:this.form.password,code:this.form.verificationCode};if(this.form.password!==this.form.confirmPassword)return void _.Notification.error({title:"注册失败",message:"密码和确认密码不匹配。",duration:3e3});await y.A.post("/api/auth/register",e,{headers:{"Content-Type":"application/json"}});_.Notification.success({title:"注册成功",message:"您已经成功注册，请登录。",duration:3e3}),this.toggleForm()}catch(t){this.loading=!1,t.response&&t.response.data&&t.response.data.errors?t.response.data.errors.forEach((e=>{_.Notification.error({title:"注册失败",message:e.msg,duration:3e3})})):_.Notification.error({title:"注册失败",message:"注册过程中出现错误，请稍后重试。",duration:3e3})}}))}},mounted(){this.currentTheme=localStorage.getItem("theme")||"light"},watch:{theme:{immediate:!0,handler(e){this.currentTheme=e}}}},he=ue,ge=(0,u.A)(he,ce,de,!1,null,"2c91603f",null),me=ge.exports,pe=s.p+"img/LunBoTuImg1.31d331e0.jpg",ve=s.p+"img/LunBoTuImg2.0921403a.jpg",fe=s.p+"img/LunBoTuImg3.287a6a48.jpg",Ce=s.p+"img/LunBoTuImg4.f02f1e54.jpg",we=s.p+"img/LunBoTuImg5.94bb15b8.jpg",ye={components:{Carousel:se,LoginForm:le,RegisterForm:me,ThemeToggle:H},data(){return{isLoading:!1,form:{country:"",phone:"",email:"",password:""},carouselItems:[{id:1,src:pe,quote:'"今天的努力，就是明天的光芒。"',author:"(Today's efforts are tomorrow's brilliance.)"},{id:2,src:ve,quote:'"学习是一场永不止步的旅程。"',author:"(Learning is a never-ending journey.)"},{id:3,src:fe,quote:'"成功不是偶然，而是日积月累。"',author:"(Success is not accidental, but accumulated day by day.)"},{id:4,src:Ce,quote:'"勇气不是没有恐惧，而是战胜恐惧。"',author:"(Courage is not the absence of fear, but the triumph over it.)"},{id:5,src:we,quote:'"每一个选择都是新的开始。"',author:"(Every choice is a new beginning.)"}],isLoginForm:!0}},methods:{toggleForm(){this.isLoginForm=!this.isLoginForm},showWelcomeNotification(){this.$nextTick((()=>{setTimeout((()=>{(0,_.Notification)({title:"Welcome!",message:"Welcome to our platform!",type:"info",duration:4e3,offset:20})}),2e3)}))}},mounted(){this.showWelcomeNotification()}},be=ye,Ae=(0,u.A)(be,Q,J,!1,null,"4884eaee",null),Ie=Ae.exports,ke=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home-container"},[t("section",{staticClass:"featured-section"},[t("div",{staticClass:"featured-wrapper"},[t("div",{staticClass:"featured-background"},[t("img",{attrs:{src:e.getImageUrl(e.HomelatestArticle.coverImage,"uploads"),alt:"Featured Article"}}),t("div",{staticClass:"gradient-overlay"})]),t("div",{staticClass:"featured-content"},[t("div",{staticClass:"featured-text"},[t("router-link",{attrs:{to:{name:"Article",params:{id:e.HomelatestArticle._id||""}}}},[t("h1",{staticClass:"featured-title"},[e._v(e._s(e.HomelatestArticle.title||"No title available"))]),t("p",{staticClass:"featured-brief"},[e._v(e._s(e.HomelatestArticle.BriefIntroduction))]),t("div",{staticClass:"featured-meta"},[t("div",{staticClass:"featured-author"},[t("img",{attrs:{src:e.getImageUrl(e.SpecifyUserInformation.avatar,"UserImg"),alt:"作者头像"}}),t("span",[e._v(e._s(e.SpecifyUserInformation.username))])]),t("div",{staticClass:"featured-stats"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(e.HomelatestArticle.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(e.HomelatestArticle.favoriteCount||0))])])]),t("button",{staticClass:"read-more-btn"},[e._v(" 阅读全文 "),t("i",{staticClass:"el-icon-arrow-right"})])])],1)])])]),t("section",{staticClass:"categories-section"},[e._m(0),t("div",{staticClass:"categories-grid"},e._l(e.articleCategories,(function(s){return t("button",{key:s._id,staticClass:"category-card",class:{active:e.selectedCategory&&e.selectedCategory._id===s._id},on:{click:function(t){return e.filterArticlesByCategory(s)}}},[t("span",{staticClass:"category-name"},[e._v(e._s(s.name))]),t("span",{staticClass:"category-count"},[e._v(e._s(e.getCategoryCount(s)))])])})),0)]),t("section",{staticClass:"articles-section"},[e._m(1),e.IsDisplay?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-state-content"},[t("i",{staticClass:"el-icon-document-delete empty-icon"}),t("h3",[e._v("这里空空如也")]),e._m(2),t("el-button",{staticClass:"browse-button",attrs:{type:"primary"},on:{click:function(t){return e.filterArticlesByCategory(e.allactive)}}},[t("i",{staticClass:"el-icon-discover"}),e._v(" 浏览全部文章 ")])],1)]):t("div",{staticClass:"articles-grid"},e._l(e.HomefilteredArticles,(function(s){return t("article",{key:s._id,staticClass:"article-card"},[t("router-link",{attrs:{to:{name:"Article",params:{id:s._id}}}},[t("div",{staticClass:"article-image"},[t("img",{attrs:{src:e.getImageUrl(s.coverImage,"uploads"),alt:"Article Image"}}),t("div",{staticClass:"article-overlay"},[t("span",{staticClass:"read-more"},[e._v("阅读更多")])])]),t("div",{staticClass:"article-content"},[t("div",{staticClass:"article-meta"},[t("span",{staticClass:"article-category"},[e._v(e._s(e.getArticleCategories(s)))]),t("span",{staticClass:"article-date"},[e._v(e._s(e.formatDate(s.createdAt)))])]),t("h3",{staticClass:"article-title"},[e._v(e._s(s.title))]),t("p",{staticClass:"article-description"},[e._v(e._s(s.BriefIntroduction))]),t("div",{staticClass:"article-footer"},[t("div",{staticClass:"article-author"},[t("img",{attrs:{src:e.getImageUrl(s.authorInfo?.avatar,"UserImg"),alt:"作者头像"}}),t("span",[e._v(e._s(s.authorInfo?.username))])]),t("div",{staticClass:"article-stats"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(s.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(s.favoriteCount||0))])])])])])],1)})),0)])])},_e=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"section-header"},[t("h2",[e._v("探索分类")]),t("p",[e._v("发现你感兴趣的内容")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"section-header"},[t("h2",[e._v("最新文章")]),t("p",[e._v("发现更多精彩内容")])])},function(){var e=this,t=e._self._c;return t("p",[e._v("这个分类下还没有文章发布"),t("br"),e._v("不如先去看看其他精彩内容吧")])}],Se={components:{},data(){return{articles:[],IsDisplay:null,Homearticles:[],HomefilteredArticles:[],HomelatestArticle:{},SpecifyUserInformation:"",articleCategories:[],allactive:{_id:"all",name:"全部"},selectedCategory:{_id:"all",name:"全部"},UserColl:[]}},computed:{...(0,m.L8)(["isLoggedIn","getUser"])},methods:{async fetchCategories(){try{const e=await y.A.get("/api/categories");this.articleCategories=e.data,this.articleCategories.unshift(this.allactive),this.articleCategories.length>0&&(this.selectedCategory=this.articleCategories[0],this.filterArticlesByCategory(this.selectedCategory))}catch(e){}},filterArticlesByCategory(e){this.selectedCategory=e,"全部"===e.name?(this.IsDisplay=!1,this.HomefilteredArticles=this.Homearticles):(this.HomefilteredArticles=this.Homearticles.filter((t=>Array.isArray(t.categories)?t.categories.some((t=>(t.name||t)===e.name)):t.categories===e.name)),0===this.HomefilteredArticles.length?this.IsDisplay=!0:this.IsDisplay=!1)},getImageUrl(e,t="uploads"){if(!e)return null;const s=!1;let a;return a=s?`http://localhost:3000/${t}/${e}`:`${window.location.origin}/${t}/${e}`,a},async HomefetchArticles(){try{const e=await y.A.get("/api/articles");this.Homearticles=e.data,this.HomefilteredArticles=this.Homearticles,this.HomelatestArticle=this.Homearticles.length>0?this.Homearticles[this.Homearticles.length-1]:{},await Promise.all(this.Homearticles.map((async e=>{if(e.user){const t=await this.getUserImgOrObject(e.user);e.authorInfo=t}}))),this.HomelatestArticle.user&&(this.SpecifyUserInformation=await this.getUserImgOrObject(this.HomelatestArticle.user))}catch(e){console.error("Error fetching articles:",e)}},async getUserImgOrObject(e){try{const t=await y.A.get(`/api/public-user-info/${e}`);return this.SpecifyUserInformation=t.data,t.data}catch(t){console.error("获取特定用户信息失败:",t)}},async loadFavorites(){if(!localStorage.getItem("token"))return;const e=await y.A.get("/api/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=e.data._id;try{const e=await y.A.get(`/api/favorites/${t}`);if(this.favorites=e.data,!Array.isArray(this.favorites))return void console.error("返回的收藏数据不是数组",this.favorites);this.favorites.forEach((e=>{})),this.UserColl=this.favorites}catch(s){console.error("加载收藏失败:",s)}},getCategoryCount(e){return"全部"===e.name?this.Homearticles.length:this.Homearticles.filter((t=>Array.isArray(t.categories)?t.categories.some((t=>(t.name||t)===e.name)):t.categories===e.name)).length},getArticleCategories(e){return e&&e.categories?"string"===typeof e.categories?e.categories:Array.isArray(e.categories)?e.categories.map((e=>e.name||e)).join(", "):"":""},formatDate(e){return e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):""}},created(){this.selectedCategory={_id:"all",name:"全部"},this.loadFavorites(),this.HomefetchArticles(),this.fetchCategories()},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){}},Ue=Se,xe=(0,u.A)(Ue,ke,_e,!1,null,"e3b5ec22",null),Le=xe.exports,Fe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"categories-page"},[t("section",{staticClass:"latest-article-section"},[t("div",{staticClass:"latest-article-wrapper"},[t("div",{staticClass:"latest-article-content"},[t("router-link",{attrs:{to:{name:"Article",params:{id:e.categorieslatestArticles[0]?._id||""}}}},[t("span",{staticClass:"article-label"},[e._v("最新文章")]),t("h1",{staticClass:"article-title"},[e._v(e._s(e.categorieslatestArticles[0]?.title||"暂无文章"))]),t("p",{staticClass:"article-brief"},[e._v(e._s(e.categorieslatestArticles[0]?.BriefIntroduction))]),t("div",{staticClass:"article-meta"},[t("div",{staticClass:"article-author"},[t("img",{attrs:{src:e.getImageUrl(e.authorAvatars[e.categorieslatestArticles[0]?.user],"UserImg"),alt:"作者头像"}}),t("span",[e._v(e._s(e.categorieslatestArticles[0]?.authorName))])]),t("div",{staticClass:"article-stats"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(e.categorieslatestArticles[0]?.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(e.categorieslatestArticles[0]?.favoriteCount||0))])])])])],1),t("div",{staticClass:"latest-article-image"},[t("img",{attrs:{src:e.getImageUrl(e.categorieslatestArticles[0]?.coverImage,"uploads"),alt:"最新文章封面"}}),t("div",{staticClass:"image-overlay"})])])]),t("section",{staticClass:"articles-section"},[t("div",{staticClass:"section-header"},[t("h2",[e._v("所有文章")]),t("div",{staticClass:"section-filters"},[t("el-select",{attrs:{placeholder:"选择分类",clearable:""},on:{change:e.handleCategoryChange},model:{value:e.selectedCategory,callback:function(t){e.selectedCategory=t},expression:"selectedCategory"}},[t("el-option",{attrs:{label:"全部",value:""}}),e._l(e.categories,(function(s){return t("el-option",{key:s._id,attrs:{label:s.name,value:s._id}},[t("span",{staticClass:"category-option"},[t("i",{class:e.getCategoryIcon(s.name)}),t("span",{staticClass:"category-name"},[e._v(e._s(s.name))])])])}))],2)],1)]),t("div",{staticClass:"articles-grid"},[e.isLoading?t("div",{staticClass:"loading-state"},[t("i",{staticClass:"el-icon-loading"}),t("p",[e._v("加载中...")])]):e.error?t("div",{staticClass:"error-state"},[t("i",{staticClass:"el-icon-warning"}),t("p",[e._v(e._s(e.error))])]):0===e.filteredArticles.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-state-content"},[t("i",{staticClass:"el-icon-document-delete empty-icon"}),t("h3",[e._v("这里空空如也")]),e._m(0),t("el-button",{staticClass:"browse-button",attrs:{type:"primary"},on:{click:function(t){e.selectedCategory=""}}},[t("i",{staticClass:"el-icon-discover"}),e._v(" 浏览全部文章 ")])],1)]):e._l(e.paginatedArticles,(function(s){return t("article",{key:s._id,staticClass:"article-card"},[t("router-link",{attrs:{to:{name:"Article",params:{id:s._id}}}},[t("div",{staticClass:"article-image"},[t("img",{attrs:{src:e.getImageUrl(s.coverImage,"uploads"),alt:"文章封面"}}),t("div",{staticClass:"article-overlay"},[t("span",{staticClass:"read-more"},[e._v("阅读更多")])])]),t("div",{staticClass:"article-content"},[t("div",{staticClass:"article-meta"},[t("span",{staticClass:"article-category"},[e._v(e._s(e.getArticleCategories(s)))]),t("span",{staticClass:"article-date"},[e._v(e._s(e.formatDate(s.createdAt)))])]),t("h3",{staticClass:"article-title"},[e._v(e._s(s.title))]),t("p",{staticClass:"article-description"},[e._v(e._s(s.BriefIntroduction))]),t("div",{staticClass:"article-footer"},[t("div",{staticClass:"article-author"},[t("img",{attrs:{src:e.getImageUrl(e.authorAvatars[s.user],"UserImg"),alt:"作者头像"}}),t("span",[e._v(e._s(s.authorName))])]),t("div",{staticClass:"article-stats"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(s.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(s.favoriteCount||0))])])])])]),t("div",{staticClass:"article-actions"},[e.userInformation?t("span",{staticClass:"favorite-button",on:{click:function(t){return t.stopPropagation(),e.toggleFavorite(s._id)}}},[t("i",{class:s.isFavorite?"el-icon-star-on":"el-icon-star-off"})]):e._e()])],1)}))],2),t("div",{staticClass:"pagination-wrapper"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.categoriesarticles.length,"page-size":e.pageSize,"current-page":e.currentPage},on:{"current-change":e.handlePageChange}})],1)])])},De=[function(){var e=this,t=e._self._c;return t("p",[e._v("这个分类下还没有文章发布"),t("br"),e._v("不如先去看看其他精彩内容吧")])}],$e={data(){return{categoriesarticles:[],categorieslatestArticles:[],authorAvatars:{},userInformation:"",currentPage:1,pageSize:6,favorites:[],isLoading:!1,error:null,selectedCategory:"",categories:[]}},components:{},computed:{paginatedArticles(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.filteredArticles.slice(e,t)},filteredArticles(){return this.selectedCategory?this.categoriesarticles.filter((e=>e.categories&&e.categories.some((e=>e._id===this.selectedCategory)))):this.categoriesarticles}},watch:{},methods:{...(0,m.i0)(["VuexloadFavorites"]),getImageUrl(e,t="uploads"){if(!e)return null;const s=!1;let a;return a=s?`http://localhost:3000/${t}/${e}`:`${window.location.origin}/${t}/${e}`,a},async categoriesfetchArticles(){this.isLoading=!0,this.error=null;try{const e=await y.A.get("/api/articles");this.categoriesarticles=e.data,this.categorieslatestArticles=this.categoriesarticles.slice(-1),await Promise.all(this.categoriesarticles.map((e=>e.user?this.fetchAuthorAvatar(e.user):Promise.resolve())))}catch(e){this.error="加载文章失败，请稍后重试",console.error("Error fetching articles:",e)}finally{this.isLoading=!1}},async fetchAuthorAvatar(e){try{const t=await y.A.get(`/api/public-user-info/${e}`);this.$set(this.authorAvatars,e,t.data.avatar)}catch(t){console.error("Error fetching user avatar:",t)}},handlePageChange(e){this.currentPage=e},async getuser(){if(!localStorage.getItem("token"))return;const e=await y.A.get("/api/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});this.userInformation=e.data._id},async toggleFavorite(e){const t=this.userInformation;try{const s=await y.A.get(`/api/favorites/${t}/${e}`);console.log("打印从后台获取回来的状态",s);const a=s.data;if(console.log("打印了收藏状态",a),a){await y.A.delete("/api/favorites",{data:{userId:t,articleId:e}}),this.$notify({title:"收藏",message:"取消收藏",type:"warning"});const s=this.categoriesarticles.find((t=>t._id===e));s&&(s.isFavorite=!1),this.VuexloadFavorites()}else{await y.A.post("/api/favorites",{userId:t,articleId:e});const s=this.categoriesarticles.find((t=>t._id===e));this.$notify({title:"收藏",message:"收藏成功",type:"success"}),console.log("收藏成功"),s&&(s.isFavorite=!0),this.VuexloadFavorites()}}catch(s){console.error("请求失败:",s)}},async loadFavorites(){if(console.log("调用了loadFavorites"),!localStorage.getItem("token"))return;const e=await y.A.get("/api/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=e.data._id;try{const e=await y.A.get(`/api/favorites/${t}`);if(this.favorites=e.data,console.log("在持久化中获取到用户的收藏记录",this.favorites),!Array.isArray(this.favorites))return void console.error("返回的收藏数据不是数组",this.favorites);this.categoriesarticles.forEach((e=>{e.isFavorite=this.favorites.some((t=>!!t.articleId&&String(t.articleId._id)===String(e._id)))}))}catch(s){console.error("加载收藏失败:",s)}},formatDate(e){return e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):""},getArticleCategories(e){return e.categories?e.categories.map((e=>e.name)).join(", "):""},async fetchCategories(){try{const e=await y.A.get("/api/categories");this.categories=e.data}catch(e){console.error("Error fetching categories:",e)}},getCategoryIcon(e){const t={"技术":"el-icon-cpu","生活":"el-icon-coffee-cup","笔记":"el-icon-notebook-2","分享":"el-icon-share","其他":"el-icon-more"};return t[e]||"el-icon-folder"},handleCategoryChange(){this.currentPage=1}},created(){this.getuser(),this.loadFavorites(),this.categoriesfetchArticles(),this.fetchCategories()}},Pe=$e,Me=(0,u.A)(Pe,Fe,De,!1,null,"b8d7a0c4",null),Te=Me.exports,Ee=s(2042),He=function(){var e=this,t=e._self._c;return t("div",{ref:"articleBox",staticClass:"articleBox"},[t("div",{staticClass:"header"},[t("button",{staticClass:"back-button",on:{click:e.goBack}},[t("i",{staticClass:"back-icon"},[e._v("←")]),t("span",{staticClass:"back-text"},[e._v("返回")])]),t("span",{staticClass:"separator"},[e._v("/")]),t("span",{staticClass:"title"},[e._v(e._s(e.article?.title))])]),e.article?t("div",{staticClass:"articleText"},[t("div",{staticClass:"articleImgTle"},[t("div",{staticClass:"img-container"},[t("img",{staticClass:"article-image",attrs:{src:e.getRandomImage(),alt:"Random Image"}}),t("div",{staticClass:"overlay"},[t("span",{staticClass:"title"},[e._v(e._s(e.article?.title))]),t("p",[e._v(e._s(e.article.BriefIntroduction))]),t("p",{staticClass:"article-author"},[t("strong",[e._v("作者 : ")]),e._v(" "+e._s(e.article.authorName))])])])]),t("div",{staticClass:"articleContent"},[t("div",{staticClass:"articletextS",domProps:{innerHTML:e._s(e.article.content)}})])]):t("div",[t("p",[e._v("Loading...")])]),t("section",{staticClass:"comment-section"},[t("h2",[e._v("评论")]),t("div",{staticClass:"comment-input"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.newComment,expression:"newComment"}],attrs:{placeholder:"写下你的评论..."},domProps:{value:e.newComment},on:{input:function(t){t.target.composing||(e.newComment=t.target.value)}}}),t("button",{on:{click:e.submitComment}},[e._v("提交评论")])]),0!==e.comments.length?t("div",{staticClass:"comments-list"},[t("h3",[e._v("最新评论")]),e._l(e.comments,(function(s){return t("div",{key:s._id,staticClass:"comment"},[t("p",[e._v(e._s(s.content))]),t("div",{staticClass:"comment-info"},[s.author&&s.createdAt?t("small",[e._v(" 来自："),t("router-link",{staticClass:"user-link",attrs:{to:{name:"OtherUser",params:{id:s.author._id}}}},[e._v(e._s(s.author.username))]),e._v(" · "+e._s(new Date(s.createdAt).toLocaleString())+" "),s.author._id===e.$store.state.user.details._id?t("button",{staticClass:"delete-btn",on:{click:function(t){return e.deleteComment(s._id)}}},[e._v("删除")]):e._e()],1):t("small",[e._v(" Unknown author · Unknown date ")])]),s.replies&&s.replies.length?t("div",{staticClass:"replies"},e._l(s.replies,(function(s){return t("div",{key:s._id,staticClass:"reply"},[t("p",[e._v(e._s(s.content))]),s.author&&s.createdAt?t("small",[e._v(" 来自："),t("router-link",{staticClass:"user-link",attrs:{to:{name:"OtherUser",params:{id:s.author._id}}}},[e._v(e._s(s.author.username))]),e._v(" · "+e._s(new Date(s.createdAt).toLocaleString())+" "),s.author._id===e.$store.state.user.details._id?t("button",{staticClass:"delete-btn",on:{click:function(t){return e.deleteComment(s._id)}}},[e._v("删除")]):e._e()],1):t("small",[e._v(" Unknown author · Unknown date ")])])})),0):e._e(),t("button",{on:{click:function(t){return e.replyToComment(s._id)}}},[e._v("回复")]),e.replyingTo===s._id?t("div",{staticClass:"reply-form"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.replyContent,expression:"replyContent"}],attrs:{placeholder:"输入回复内容..."},domProps:{value:e.replyContent},on:{input:function(t){t.target.composing||(e.replyContent=t.target.value)}}}),t("button",{on:{click:function(t){return e.submitReply(s._id)}}},[e._v("提交")]),t("button",{on:{click:e.cancelReply}},[e._v("取消")])]):e._e()])}))],2):t("div")])])},Be=[],Ve={data(){return{newComment:"",comments:[],article:null,replyingTo:null,replyContent:"",progressBarWidth:0,scrollPosition:0,articleBoxHeight:0,acid:"",images:[{src:s(9123)},{src:s(3060)}],themes:{light:{"--primary-color":"#3498db","--secondary-background":"#f8f9ff","--active-background":"#f7f7f8","--background-color":"#ffffff","--border-color":" #f0f1fb","--text-color":"#000000","--button-color":"#1988fa","--card-background":" #f5f5f5","--gradient-primary":"linear-gradient(to right, #1988fa 0%, #33c4f9 50%, #00f2fe 100%)"},dark:{"--primary-color":"#e74c3c","--active-background":"#1a1a1a","--secondary-background":"#1f1f1f","--background-color":"#000000","--border-color":" #2c2c2c","--text-color":"#ecf0f1","--button-color":"#015aea","--card-background":" #212121","--gradient-primary":"linear-gradient(to right, #012a63, #015aea, #4d9ef7)"}}}},created(){const e=this.$route.params.id;this.acid=e,this.fetchComments(e),this.fetchArticleData()},mounted(){const e=localStorage.getItem("theme")||"light",t=localStorage.getItem("token");t&&y.A.get("/api/user",{headers:{Authorization:`Bearer ${t}`}}).then((e=>{this.$store.dispatch("updateUser",{token:t,details:e.data})})).catch((e=>{console.error("Error fetching user data:",e)})),this.updateTheme(e),console.log("本地储存状态",e),this.$nextTick((()=>{this.handleScroll(),window.addEventListener("scroll",this.handleScroll)})),this.getLastViewedArticle().then((e=>{setTimeout((()=>{null!==e&&window.scrollTo({top:e,behavior:"smooth"})}),100)})),window.addEventListener("scroll",this.handleScroll)},computed:{},beforeDestroy(){const e=this.$refs.articleBox;e&&e.removeEventListener("scroll",this.handleScroll),this.saveScrollPosition(),console.log("退出成功"),window.removeEventListener("resize",this.handleResize)},methods:{goBack(){window.history.length>1?this.$router.go(-1):this.$router.push("/Index/Home")},updateTheme(e){console.log(e),this.currentTheme=e;const t=this.themes[e];for(const s in t)document.documentElement.style.setProperty(s,t[s]);localStorage.setItem("theme",e)},handleScroll(){const e=this.$refs.articleBox;e&&(this.scrollPosition=window.scrollY,this.articleBoxHeight=e.clientHeight)},async getLastViewedArticle(){if(!localStorage.getItem("token"))return null;console.log("token存在"),console.log(localStorage.getItem("token"));try{const e=await y.A.get(`/api/user/last-viewed/${this.acid}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return e.data.scrollPosition}catch(e){return console.error("Error retrieving last viewed article:",e),null}},async saveScrollPosition(){if(!localStorage.getItem("token"))return;console.log(this.articleBoxHeight),console.log(window.innerHeight);const e=this.articleBoxHeight-window.innerHeight;console.log("最大宽度",e);try{await y.A.post("/api/user/save-progress",{articleId:this.acid,scrollPosition:this.scrollPosition,maxScrollPosition:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})}catch(t){console.error("Error saving scroll position:",t)}},handleResize(){const e=this.$refs.articleBox;e.style.height=`${window.innerHeight}px`},goBack(){window.history.length>1?this.$router.go(-1):this.$router.push("/Index/Home")},getRandomImage(){const e=Math.floor(Math.random()*this.images.length);return this.images[e].src},async fetchArticleData(){try{const e=this.$route.params.id,t=await y.A.get(`/api/articles/${e}`);this.article=t.data}catch(e){console.error("Error fetching article data:",e)}},replyToComment(e){this.replyingTo=e,this.replyContent=""},cancelReply(){this.replyingTo=null,this.replyContent=""},async submitComment(){if(this.newComment.trim())try{await y.A.post("/api/comments",{content:this.newComment,articleId:this.acid,author:this.user},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),this.newComment="",await this.fetchComments(this.acid)}catch(e){console.error("Error submitting comment:",e)}else alert("评论内容不能为空")},async submitReply(e){if(this.replyContent.trim())try{await y.A.post("/api/comments/reply",{content:this.replyContent,articleId:this.article._id,parentCommentId:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),this.fetchComments(this.article._id),this.replyingTo=null,this.replyContent=""}catch(t){console.error("Error submitting reply:",t)}else alert("回复内容不能为空")},async fetchComments(e){try{const t=localStorage.getItem("token"),s=await y.A.get(`/api/comments/${e}/comments`,{headers:{Authorization:`Bearer ${t}`}});if(t&&!this.$store.state.user.token){const e=await y.A.get("/api/users",{headers:{Authorization:`Bearer ${t}`}});this.$store.dispatch("updateUser",{token:t,details:e.data})}this.comments=s.data.comments,console.log("Comments loaded:",this.comments)}catch(t){console.error("Error fetching comments:",t)}},async deleteComment(e){try{const t=await this.$confirm("确定要删除这条评论吗？删除后将同时删除该评论下的所有回复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});"confirm"===t&&(await y.A.delete(`/api/comments/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),await this.fetchComments(this.acid),this.$message.success("评论删除成功"))}catch(t){"cancel"!==t&&(console.error("Error deleting comment:",t),this.$message.error("删除评论失败，请重试"))}}}},ze=Ve,Ne=(0,u.A)(ze,He,Be,!1,null,"02a4a2be",null),Re=Ne.exports,je=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-page"},[t("div",{staticClass:"user-header"},[t("div",{staticClass:"user-banner"},[t("img",{attrs:{src:s(9123),alt:"banner"}}),t("div",{staticClass:"user-avatar"},[t("img",{attrs:{src:e.getImageUrl(e.user.avatar,"UserImg"),alt:"头像"},on:{click:e.openDialog}})])]),t("div",{staticClass:"user-info"},[t("div",{staticClass:"user-details"},[t("div",{staticClass:"username-container"},[t("h2",[e._v(e._s(e.user.username))]),t("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:e.openEditUsernameDialog}})],1),t("p",[e._v(e._s(e.user.email))]),t("el-button",{staticClass:"change-password-btn",attrs:{type:"text"},on:{click:e.openChangePasswordDialog}},[e._v("修改密码")])],1),t("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"primary"},on:{click:e.LU_logout}},[e._v("退出登录")])],1)]),t("div",{staticClass:"user-content"},[t("div",{staticClass:"user-sidebar"},[t("el-card",{staticClass:"statistics-card"},[t("div",{staticClass:"stat-item"},[t("div",{staticClass:"stat-value"},[e._v(e._s(e.totalViews))]),t("div",{staticClass:"stat-label"},[e._v("浏览量")])]),t("div",{staticClass:"stat-item"},[t("div",{staticClass:"stat-value"},[e._v(e._s(e.userArticles.length))]),t("div",{staticClass:"stat-label"},[e._v("文章数")])]),t("div",{staticClass:"stat-item clickable",on:{click:e.showFollowers}},[t("div",{staticClass:"stat-value"},[e._v(e._s(e.followersCount))]),t("div",{staticClass:"stat-label"},[e._v("关注者")])]),t("div",{staticClass:"stat-item clickable",on:{click:e.showFollowing}},[t("div",{staticClass:"stat-value"},[e._v(e._s(e.followingCount))]),t("div",{staticClass:"stat-label"},[e._v("关注")])]),t("el-button",{staticClass:"create-article-btn",attrs:{type:"primary"},on:{click:e.openCreateArticleDialog}},[t("i",{staticClass:"el-icon-edit"}),e._v(" 创作文章 ")])],1),t("el-card",{staticClass:"menu-card"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"已发布",name:"first"}},[t("div",{staticClass:"tab-content"},[e.userArticles&&e.userArticles.length>0?t("div",{staticClass:"articles-list"},[e._l(e.paginatedArticles,(function(s){return t("div",{key:s._id,staticClass:"article-item"},[t("router-link",{attrs:{to:{name:"Article",params:{id:s._id}}}},[t("div",{staticClass:"article-content"},[s.coverImage?t("img",{attrs:{src:e.getImageUrl(s.coverImage,"uploads"),alt:"封面图片"}}):e._e(),t("div",{staticClass:"article-info"},[t("h4",[e._v(e._s(s.title))]),t("p",[e._v(e._s(s.BriefIntroduction||"暂无简介"))]),t("div",{staticClass:"article-meta"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(s.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(s.favoriteCount||0))]),t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return t.preventDefault(),e.confirmDelete(s._id)}}},[e._v("删除")])],1)])])])],1)})),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.articlesCurrentPage,"page-size":e.pageSize,layout:"prev, pager, next",total:e.userArticles.length},on:{"current-change":e.handleArticlesPageChange,"update:currentPage":function(t){e.articlesCurrentPage=t},"update:current-page":function(t){e.articlesCurrentPage=t}}})],1)],2):t("div",{staticClass:"no-data"},[e._v("暂无发布文章")])])]),t("el-tab-pane",{attrs:{label:"收藏",name:"second"}},[t("div",{staticClass:"tab-content"},[e.favorites&&e.favorites.length>0?t("div",{staticClass:"favorites-list"},[e._l(e.paginatedFavorites,(function(s){return t("div",{key:s.articleId?._id||s._id,staticClass:"article-item"},[s.articleId?._id?t("router-link",{attrs:{to:{name:"Article",params:{id:s.articleId._id}}}},[t("div",{staticClass:"article-content"},[s.articleId?.coverImage?t("img",{attrs:{src:e.getImageUrl(s.articleId.coverImage,"uploads"),alt:"封面图片"}}):e._e(),t("div",{staticClass:"article-info"},[t("h4",[e._v(e._s(s.articleId?.title||"未知标题"))]),t("p",[e._v(e._s(s.articleId?.BriefIntroduction||"暂无简介"))]),t("div",{staticClass:"article-meta"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(s.articleId?.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(s.articleId?.favoriteCount||0))]),t("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-star-off"},on:{click:function(t){return t.preventDefault(),e.confirmUnfavorite(s._id)}}},[e._v("取消收藏")])],1)])])]):t("div",{staticClass:"article-content invalid-favorite"},[t("div",{staticClass:"article-info"},[t("h4",[e._v("无效收藏记录")]),t("p",[e._v("此收藏记录的文章可能已被删除")]),t("div",{staticClass:"article-meta"},[t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return t.preventDefault(),e.confirmUnfavorite(s._id)}}},[e._v("删除无效记录")])],1)])])],1)})),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.favoritesCurrentPage,"page-size":e.pageSize,layout:"prev, pager, next",total:e.favorites.length},on:{"current-change":e.handleFavoritesPageChange,"update:currentPage":function(t){e.favoritesCurrentPage=t},"update:current-page":function(t){e.favoritesCurrentPage=t}}})],1)],2):t("div",{staticClass:"no-data"},[e._v("暂无收藏文章")])])])],1)],1)],1),t("div",{staticClass:"user-main"},[t("el-card",{staticClass:"recent-view-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("最近浏览")])]),e.viewedArticles&&e.viewedArticles.length>0?t("div",{staticClass:"recent-view-content"},[e._l(e.paginatedViewedArticles,(function(s){return t("div",{key:s.articleId,staticClass:"article-item"},[t("router-link",{attrs:{to:{name:"Article",params:{id:s.articleId}}}},[t("div",{staticClass:"article-content"},[s.coverImage?t("img",{attrs:{src:e.getImageUrl(s.coverImage,"uploads"),alt:"封面图片"}}):e._e(),t("div",{staticClass:"article-info article-info-title"},[t("h4",[e._v(e._s(s.title||"未知标题"))]),t("div",{staticClass:"article-meta"},[t("span",[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(s.viewCount||0))]),t("span",[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(s.favoriteCount||0))]),t("span",{staticClass:"reading-progress"},[t("el-progress",{staticClass:"custom-progress",attrs:{percentage:e.calculateProgress(s.scrollPosition,s.maxScrollPosition),format:e=>`已读${e}%`,"stroke-width":18,"show-text":!0,color:["#67C23A","#E6A23C","#F56C6C"],"text-inside":!0}})],1),t("span",{staticClass:"view-time"},[e._v(e._s(new Date(s.lastViewedAt).toLocaleString()))])])])])])],1)})),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.viewedArticlesCurrentPage,"page-size":e.pageSize,layout:"prev, pager, next",total:e.viewedArticles.length},on:{"current-change":e.handleViewedArticlesPageChange,"update:currentPage":function(t){e.viewedArticlesCurrentPage=t},"update:current-page":function(t){e.viewedArticlesCurrentPage=t}}})],1)],2):t("div",{staticClass:"no-data"},[e._v("暂无浏览记录")])])],1)]),t("el-dialog",{attrs:{title:"修改头像",visible:e.dialogVisible,width:"300px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-upload",{attrs:{action:"/api/update-avatar",headers:e.headers,name:"avatar","list-type":"picture-card","on-success":e.handleSuccess,"on-error":e.handleError}},[t("i",{staticClass:"el-icon-plus"})]),t("p",[e._v("点击上传新的头像")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")])],1)],1),t("el-dialog",{attrs:{title:"确认删除",visible:e.deleteDialogVisible,width:"30%"},on:{"update:visible":function(t){e.deleteDialogVisible=t}}},[t("span",[e._v("确定要删除这篇文章吗？此操作不可恢复。")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.deleteDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"danger"},on:{click:e.deleteArticle}},[e._v("确定")])],1)]),t("el-dialog",{attrs:{title:"确认取消收藏",visible:e.unfavoriteDialogVisible,width:"30%"},on:{"update:visible":function(t){e.unfavoriteDialogVisible=t}}},[t("span",[e._v("确定要取消收藏这篇文章吗？")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.unfavoriteDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"warning"},on:{click:e.unfavoriteArticle}},[e._v("确定")])],1)]),t("el-dialog",{attrs:{title:"修改昵称",visible:e.editUsernameDialogVisible,width:"400px","custom-class":"custom-dialog","close-on-click-modal":!1},on:{"update:visible":function(t){e.editUsernameDialogVisible=t}}},[t("el-form",{ref:"usernameForm",staticClass:"custom-form",attrs:{model:e.usernameForm,rules:e.usernameRules,"label-position":"top"}},[t("el-form-item",{attrs:{label:"新昵称",prop:"newUsername"}},[t("el-input",{attrs:{placeholder:"请输入新昵称","prefix-icon":"el-icon-user",maxlength:"20","show-word-limit":""},model:{value:e.usernameForm.newUsername,callback:function(t){e.$set(e.usernameForm,"newUsername",t)},expression:"usernameForm.newUsername"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{plain:""},on:{click:function(t){e.editUsernameDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitUsername}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"修改密码",visible:e.changePasswordDialogVisible,width:"400px","custom-class":"custom-dialog","close-on-click-modal":!1},on:{"update:visible":function(t){e.changePasswordDialogVisible=t}}},[t("el-form",{ref:"passwordForm",staticClass:"custom-form",attrs:{model:e.passwordForm,rules:e.passwordRules,"label-position":"top"}},[t("el-form-item",{attrs:{label:"原密码",prop:"currentPassword"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入原密码","prefix-icon":"el-icon-lock","show-password":""},model:{value:e.passwordForm.currentPassword,callback:function(t){e.$set(e.passwordForm,"currentPassword",t)},expression:"passwordForm.currentPassword"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入新密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.passwordForm.newPassword,callback:function(t){e.$set(e.passwordForm,"newPassword",t)},expression:"passwordForm.newPassword"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[t("el-input",{attrs:{type:"password",placeholder:"请确认新密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.passwordForm.confirmPassword,callback:function(t){e.$set(e.passwordForm,"confirmPassword",t)},expression:"passwordForm.confirmPassword"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{plain:""},on:{click:function(t){e.changePasswordDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitPassword}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"创作文章",visible:e.createArticleDialogVisible,width:"80%",fullscreen:e.isMobile,"custom-class":"create-article-dialog","close-on-click-modal":!1},on:{"update:visible":function(t){e.createArticleDialogVisible=t}}},[t("el-form",{ref:"articleForm",attrs:{model:e.articleForm,rules:e.articleRules,"label-position":"top"}},[t("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},model:{value:e.articleForm.title,callback:function(t){e.$set(e.articleForm,"title",t)},expression:"articleForm.title"}})],1),t("el-form-item",{attrs:{label:"文章分类",prop:"categories"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文章分类"},model:{value:e.articleForm.categories,callback:function(t){e.$set(e.articleForm,"categories",t)},expression:"articleForm.categories"}},e._l(e.categories,(function(s){return t("el-option",{key:s._id,attrs:{label:s.name,value:s._id}},[t("span",{staticClass:"category-option"},[t("i",{class:e.getCategoryIcon(s.name)}),t("span",{staticClass:"category-name"},[e._v(e._s(s.name))]),t("span",{staticClass:"category-desc"},[e._v(e._s(s.description))])])])})),1)],1),t("el-form-item",{attrs:{label:"封面图片",prop:"coverImage"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:"","file-list":e.fileList,"on-change":e.handleFileUpload,"auto-upload":!1,limit:1,"on-exceed":e.handleExceed}},[t("el-button",[e._v("点击上传图片")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传一张封面图片")])],1)],1),t("el-form-item",{attrs:{label:"文章简介",prop:"BriefIntroduction"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入文章简介",maxlength:"200","show-word-limit":""},model:{value:e.articleForm.BriefIntroduction,callback:function(t){e.$set(e.articleForm,"BriefIntroduction",t)},expression:"articleForm.BriefIntroduction"}})],1),t("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[t("div",{staticClass:"editor-container"},[t("quill-editor",{staticClass:"quill-editor",attrs:{options:e.editorOptions},on:{"text-change":e.onEditorChange},model:{value:e.articleForm.content,callback:function(t){e.$set(e.articleForm,"content",t)},expression:"articleForm.content"}})],1)])],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.createArticleDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.submitArticle}},[e._v("发布文章")])],1)],1),t("Footer"),t("el-dialog",{attrs:{title:"关注者",visible:e.followersDialogVisible,width:"50%",center:""},on:{"update:visible":function(t){e.followersDialogVisible=t}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingFollowers,expression:"loadingFollowers"}]},[e.followersList.length>0?t("div",{staticClass:"user-list"},e._l(e.followersList,(function(s){return t("div",{key:s._id,staticClass:"user-list-item",on:{click:function(t){return e.navigateToUser(s._id)}}},[t("div",{staticClass:"user-avatar small"},[t("img",{attrs:{src:e.getImageUrl(s.avatar,"UserImg")||e.defaultAvatar,alt:s.username}})]),t("div",{staticClass:"user-info"},[t("span",{staticClass:"user-name"},[e._v(e._s(s.username))]),s.bio?t("span",{staticClass:"user-bio"},[e._v(e._s(s.bio))]):e._e()])])})),0):e.loadingFollowers?e._e():t("div",{staticClass:"empty-list"},[e._v(" 暂无关注者 ")])])]),t("el-dialog",{attrs:{title:"关注",visible:e.followingDialogVisible,width:"50%",center:""},on:{"update:visible":function(t){e.followingDialogVisible=t}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingFollowing,expression:"loadingFollowing"}]},[e.followingList.length>0?t("div",{staticClass:"user-list"},e._l(e.followingList,(function(s){return t("div",{key:s._id,staticClass:"user-list-item",on:{click:function(t){return e.navigateToUser(s._id)}}},[t("div",{staticClass:"user-avatar small"},[t("img",{attrs:{src:e.getImageUrl(s.avatar,"UserImg")||e.defaultAvatar,alt:s.username}})]),t("div",{staticClass:"user-info"},[t("span",{staticClass:"user-name"},[e._v(e._s(s.username))]),s.bio?t("span",{staticClass:"user-bio"},[e._v(e._s(s.bio))]):e._e()])])})),0):e.loadingFollowing?e._e():t("div",{staticClass:"empty-list"},[e._v(" 暂无关注 ")])])])],1)},Oe=[],We=s(8982),qe={components:{Footer:j,VueEditor:We.aZ},data(){return{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},user:"",dialogVisible:!1,deleteDialogVisible:!1,unfavoriteDialogVisible:!1,articleToDelete:null,favoriteToRemove:null,favorites:[],fileList:[],editorOptions:{theme:"snow",modules:{toolbar:[["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["clean"],["image"]]}},articleForm:{title:"",BriefIntroduction:"",content:"",categories:"",coverImage:null},userArticles:[],viewedArticles:[],isMobile:!1,activeName:"first",totalViews:0,editUsernameDialogVisible:!1,usernameForm:{newUsername:""},usernameRules:{newUsername:[{required:!0,message:"请输入新昵称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]},changePasswordDialogVisible:!1,passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},createArticleDialogVisible:!1,submitting:!1,categories:[],articleRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章分类",trigger:"change"}],BriefIntroduction:[{required:!0,message:"请输入文章简介",trigger:"blur"},{max:200,message:"简介不能超过200个字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}]},customToolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["image","code-block"],[{color:[]},{background:[]}],[{align:[]}]],passwordRules:{currentPassword:[{required:!0,message:"请输入原密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(e,t,s)=>{t!==this.passwordForm.newPassword?s(new Error("两次输入的密码不一致")):s()},trigger:"blur"}]},followersCount:0,followingCount:0,defaultAvatar:"/UserImg/default-avatar.png",followersDialogVisible:!1,followingDialogVisible:!1,followersList:[],followingList:[],loadingFollowers:!1,loadingFollowing:!1,articlesCurrentPage:1,favoritesCurrentPage:1,viewedArticlesCurrentPage:1,pageSize:10}},props:{lastViewedArticleZi:{type:Object}},computed:{...(0,m.L8)(["getUser","isLoggedIn"]),paginatedArticles(){const e=(this.articlesCurrentPage-1)*this.pageSize,t=e+this.pageSize;return this.userArticles.slice(e,t)},paginatedFavorites(){const e=(this.favoritesCurrentPage-1)*this.pageSize,t=e+this.pageSize;return this.favorites.slice(e,t)},paginatedViewedArticles(){const e=(this.viewedArticlesCurrentPage-1)*this.pageSize,t=e+this.pageSize;return this.viewedArticles.slice(e,t)}},created(){this.user=this.getUser,!this.isLoggedIn||this.user&&this.user._id?this.initializeUserData():y.A.get("/api/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then((e=>{const t=e.data;this.$store.dispatch("updateUser",{token:localStorage.getItem("token"),details:t}),this.user=t,this.initializeUserData()})).catch((e=>{console.error("获取用户信息失败:",e),this.$message.error("获取用户信息失败")}))},async mounted(){this.isLoggedIn&&this.user&&this.user._id&&(await this.loadUserArticles(),await this.loadTotalViews(),await this.loadViewedArticles(),await this.loadFavorites(),await this.fetchUserStats(),this.fetchCategories())},methods:{async initializeUserData(){if(!this.user||!this.user._id)return void console.error("用户信息不完整");const e=localStorage.getItem("token");if(!e)return void this.$router.push("/login");const t={Authorization:`Bearer ${e}`};try{const e=await y.A.get(`/api/users/${this.user._id}/articles`);this.userArticles=e.data,this.totalViews=this.userArticles.reduce(((e,t)=>e+(t.viewCount||0)),0)}catch(s){console.error("获取用户文章失败:",s),this.$message.error("获取用户文章失败")}try{const e=await y.A.get(`/api/favorites/${this.user._id}`,{headers:t});this.favorites=e.data}catch(s){console.error("获取收藏失败:",s),this.$message.error("获取收藏失败")}try{const e=await y.A.get("/api/user/viewed-articles",{headers:t});this.viewedArticles=e.data}catch(s){console.error("获取浏览记录失败:",s),this.$message.error("获取浏览记录失败")}await this.fetchUserStats()},async loadUserArticles(){try{if(!this.user._id)return;const e=await y.A.get(`/api/users/${this.user._id}/articles`);this.userArticles=e.data}catch(e){console.error("加载用户文章失败:",e),this.$message.error("加载文章列表失败")}},async loadViewedArticles(){try{const e=await y.A.get("/api/user/viewed-articles",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});this.viewedArticles=e.data.sort(((e,t)=>new Date(t.lastViewedAt)-new Date(e.lastViewedAt)))}catch(e){console.error("加载浏览记录失败:",e),this.$message.error("加载浏览记录失败")}},LU_logout(){this.$emit("call-parent")},getImageUrl(e,t){if(!e)return null;const s=window.location.origin,a="UserImg"===t?`UserImg/${e}`:`uploads/${e}`,i=new URL(a,s);return i.toString()},openDialog(){this.dialogVisible=!0},handleSuccess(e,t){this.$message.success("头像上传成功！"),this.dialogVisible=!1},async fetchCategories(){try{const e=await y.A.get("/api/categories");this.categories=e.data}catch(e){console.error("Error fetching categories:",e),this.$message.error("获取分类列表失败")}},getCategoryIcon(e){const t={"技术":"el-icon-cpu","生活":"el-icon-coffee-cup","笔记":"el-icon-notebook-2","分享":"el-icon-share","其他":"el-icon-folder"};return t[e]||"el-icon-folder"},handleError(e){this.$message.error("头像上传失败，请重试！")},confirmDelete(e){this.articleToDelete=e,this.deleteDialogVisible=!0},async deleteArticle(){try{await y.A.delete(`/api/articles/${this.articleToDelete}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),this.$message.success("文章删除成功"),this.deleteDialogVisible=!1,this.loadUserArticles()}catch(e){console.error("删除文章失败:",e),this.$message.error("删除文章失败，请重试")}},confirmUnfavorite(e){this.favoriteToRemove=e,this.unfavoriteDialogVisible=!0},async unfavoriteArticle(){try{const e=this.user._id,t=this.favorites.find((e=>e._id===this.favoriteToRemove));if(!t)throw new Error("未找到收藏记录");if(!t.articleId)return await y.A.delete("/api/favorites",{data:{favoriteId:t._id}}),this.$notify({title:"收藏",message:"已删除无效收藏记录",type:"warning"}),this.unfavoriteDialogVisible=!1,void this.loadFavorites();const s=t.articleId._id;if(!e||!s)throw new Error("无效的用户ID或文章ID");await y.A.delete("/api/favorites",{data:{userId:e,articleId:s}}),this.$notify({title:"收藏",message:"取消收藏",type:"warning"}),this.unfavoriteDialogVisible=!1,this.loadFavorites()}catch(e){console.error("取消收藏失败:",e),this.$message.error("取消收藏失败，请重试")}},async loadUserArticles(){try{if(!this.user._id)return;const e=await y.A.get(`/api/users/${this.user._id}/articles`);this.userArticles=e.data}catch(e){console.error("加载用户文章失败:",e),this.$message.error("加载文章列表失败")}},async loadFavorites(){if(this.isLoggedIn&&this.user&&this.user._id)try{console.log("正在加载用户收藏，用户ID:",this.user._id);const e=await y.A.get(`/api/favorites/${this.user._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(this.favorites=e.data,console.log("获取到的收藏列表:",this.favorites),!Array.isArray(this.favorites))return void console.error("返回的收藏数据不是数组",this.favorites)}catch(e){console.error("加载收藏失败:",e.response||e),this.$message.error("加载收藏列表失败")}else console.log("用户未登录或用户信息不完整，无法加载收藏")},async loadTotalViews(){try{if(!this.user._id)return;const e=await y.A.get(`/api/users/${this.user._id}/total-views`);this.totalViews=e.data.totalViews}catch(e){console.error("加载总浏览量失败:",e),this.$message.error("加载总浏览量失败")}},calculateProgress(e,t){if(!t)return 0;const s=e/t*100;return Math.min(Math.round(s),100)},openCreateArticleDialog(){this.createArticleDialogVisible=!0,this.$nextTick((()=>{this.$refs.articleForm?.resetFields(),this.fetchCategories()}))},handleExceed(e,t){this.$message.warning("只能上传一张封面图片")},handleFileUpload(e,t){const s=5242880;if(e.size>s)return this.$notify({title:"上传失败",message:"图片大小不能超过5MB",type:"error",duration:3e3}),void t.splice(t.indexOf(e),1);t.length>1&&t.splice(0,1),this.articleForm.coverImage=e.raw,this.fileList=t},onEditorChange(){this.$refs.articleForm?.validateField("content")},async submitArticle(){this.$refs.articleForm.validate((async e=>{if(e)try{this.submitting=!0;const e=new FormData;Object.keys(this.articleForm).forEach((t=>{e.append(t,this.articleForm[t])})),e.append("author",this.user._id),console.log(this.articleForm);const t=localStorage.getItem("token");await y.A.post("/api/articles",e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}});this.$notify({title:"成功",message:"文章发布成功",type:"success"}),this.articleForm={title:"",BriefIntroduction:"",content:"",categories:"",coverImage:null},this.fileList=[],this.createArticleDialogVisible=!1,this.loadUserArticles()}catch(t){let e="文章发布失败";t.response&&t.response.data&&(e=t.response.data.message||t.response.data.msg||e),this.$notify({title:"发布失败",message:e,type:"error",duration:3e3}),console.error("文章发布失败:",t.response||t)}finally{this.submitting=!1}}))},openEditUsernameDialog(){this.usernameForm.newUsername=this.user.username,this.editUsernameDialogVisible=!0},submitUsername(){this.$refs.usernameForm.validate((async e=>{if(e)try{console.log(this.usernameForm.newUsername);await y.A.put(`/api/update-username/${this.user._id}`,{newUsername:this.usernameForm.newUsername},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});this.user.username=this.usernameForm.newUsername,this.$store.dispatch("updateUser",{details:{...this.user}}),this.$message.success("昵称修改成功"),this.editUsernameDialogVisible=!1}catch(t){this.$message.error(t.response?.data?.message||"修改昵称失败，请重试")}}))},openChangePasswordDialog(){this.changePasswordDialogVisible=!0,this.$nextTick((()=>{this.$refs.passwordForm?.resetFields()}))},submitPassword(){this.$refs.passwordForm.validate((async e=>{if(e)try{await y.A.put(`/api/update-password/${this.user._id}`,{currentPassword:this.passwordForm.currentPassword,newPassword:this.passwordForm.newPassword},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),this.$message.success("密码修改成功，请重新登录"),this.changePasswordDialogVisible=!1,localStorage.removeItem("token"),this.$store.dispatch("updateUser",{token:null,details:null}),this.$router.push("/login")}catch(t){this.$message.error(t.response?.data?.message||"修改密码失败，请重试")}}))},async fetchUserStats(){try{if(!this.user||!this.user._id)return;console.log("正在获取用户统计信息...",this.user._id);const e=await y.A.get(`/api/user-stats/${this.user._id}`),t=e.data;this.followersCount=t.followersCount||0,this.followingCount=t.followingCount||0,console.log("用户统计信息",t)}catch(e){console.error("获取用户统计信息失败:",e.response||e),this.$message.error("获取用户统计信息失败")}},async refreshUserData(){if(this.isLoggedIn)try{const e=await y.A.get("/api/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=e.data;this.$store.dispatch("updateUser",{token:localStorage.getItem("token"),details:t}),this.user=t,await this.loadUserArticles(),await this.loadViewedArticles(),await this.loadFavorites(),await this.fetchUserStats()}catch(e){console.error("刷新用户数据失败:",e),this.$message.error("刷新用户数据失败")}},navigateToUser(e){e===this.user._id?this.refreshUserData():this.$router.push(`/user/${e}`)},async showFollowers(){if(console.log("显示关注者列表，当前关注者数量:",this.followersCount),0!==this.followersCount){this.followersDialogVisible=!0,this.loadingFollowers=!0;try{console.log("正在获取关注者列表，用户ID:",this.user._id);const e=await y.A.get(`/api/follow/followers/${this.user._id}`);this.followersList=e.data,console.log("获取到的关注者列表:",this.followersList)}catch(e){console.error("获取关注者列表失败:",e.response||e),this.$message.error("获取关注者列表失败")}finally{this.loadingFollowers=!1}}else this.$message.info("暂无关注者")},async showFollowing(){if(console.log("显示关注列表，当前关注数量:",this.followingCount),0!==this.followingCount){this.followingDialogVisible=!0,this.loadingFollowing=!0;try{console.log("正在获取关注列表，用户ID:",this.user._id);const e=await y.A.get(`/api/follow/following/${this.user._id}`);this.followingList=e.data,console.log("获取到的关注列表:",this.followingList)}catch(e){console.error("获取关注列表失败:",e.response||e),this.$message.error("获取关注列表失败")}finally{this.loadingFollowing=!1}}else this.$message.info("暂无关注")},handleArticlesPageChange(e){this.articlesCurrentPage=e},handleFavoritesPageChange(e){this.favoritesCurrentPage=e},handleViewedArticlesPageChange(e){this.viewedArticlesCurrentPage=e}},mounted(){this.loadFavorites(),this.loadUserArticles(),this.loadTotalViews(),this.loadViewedArticles(),this.fetchUserStats(),this.fetchCategories()}},Ke=qe,Qe=(0,u.A)(Ke,je,Oe,!1,null,"4c5e0db4",null),Je=Qe.exports,Xe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"other-user"},[t("div",{staticClass:"header"},[t("button",{staticClass:"back-button",on:{click:e.goBack}},[t("i",{staticClass:"back-icon"},[e._v("←")]),t("span",{staticClass:"back-text"},[e._v("返回")])]),t("span",{staticClass:"separator"},[e._v("/")]),t("span",{staticClass:"title"},[e._v("用户主页")])]),t("section",{staticClass:"user-profile-card"},[t("div",{staticClass:"profile-header"},[t("div",{staticClass:"profile-avatar"},[t("img",{attrs:{src:e.getImageUrl(e.userInfo?.avatar,"UserImg")||e.defaultAvatar,alt:"用户头像"}})]),t("div",{staticClass:"profile-info"},[t("h2",{staticClass:"user-name"},[e._v(e._s(e.userInfo.username))]),t("p",{staticClass:"user-bio"},[e._v(e._s(e.userBio))]),t("div",{staticClass:"user-stats"},[t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-value"},[e._v(e._s(e.articlesCount))]),t("span",{staticClass:"stat-label"},[e._v("文章")])]),t("div",{staticClass:"stat-item clickable",on:{click:e.showFollowers}},[t("span",{staticClass:"stat-value"},[e._v(e._s(e.followersCount))]),t("span",{staticClass:"stat-label"},[e._v("关注者")])]),t("div",{staticClass:"stat-item clickable",on:{click:e.showFollowing}},[t("span",{staticClass:"stat-value"},[e._v(e._s(e.followingCount))]),t("span",{staticClass:"stat-label"},[e._v("关注")])])]),t("div",{staticClass:"action-buttons"},[t("el-button",{staticClass:"follow-btn",class:{"is-following":e.isFollowing},attrs:{type:"primary",loading:e.loading,disabled:e.isSelfProfile||e.loading},on:{click:e.handleFollow}},[e._v(" "+e._s(e.isFollowing?"已关注":"关注")+" ")]),t("el-button",{staticClass:"message-btn",attrs:{type:"success",icon:"el-icon-message"},on:{click:e.handleSendMessage}},[e._v(" 发消息 ")])],1)])])]),t("section",{staticClass:"user-articles"},[t("div",{staticClass:"section-header"},[t("h3",{staticClass:"section-title"},[e._v("发布的文章")]),t("div",{staticClass:"view-options"},[t("el-radio-group",{attrs:{size:"small"},model:{value:e.viewMode,callback:function(t){e.viewMode=t},expression:"viewMode"}},[t("el-radio-button",{attrs:{label:"grid"}},[e._v("网格视图")]),t("el-radio-button",{attrs:{label:"list"}},[e._v("列表视图")])],1)],1)]),t("div",{staticClass:"articles-container",class:e.viewMode},e._l(e.articles,(function(s){return t("article",{key:s.id,staticClass:"article-card"},[t("div",{staticClass:"article-cover"},[t("img",{attrs:{src:e.getImageUrl(s.coverImage,"uploads"),alt:s.title}})]),t("div",{staticClass:"article-content"},[t("h4",{staticClass:"article-title"},[e._v(e._s(s.title))]),t("p",{staticClass:"article-excerpt"},[e._v(e._s(s.excerpt))]),t("div",{staticClass:"article-meta"},[t("span",{staticClass:"publish-date"},[t("i",{staticClass:"el-icon-date"}),e._v(" "+e._s(e.formatDate(s.publishDate))+" ")]),t("span",{staticClass:"read-count"},[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(s.viewCount)+" ")]),t("span",{staticClass:"like-count"},[t("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(s.favoriteCount)+" ")])])])])})),0),t("div",{staticClass:"pagination-wrapper"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.totalArticles,"page-size":e.pageSize,"current-page":e.currentPage},on:{"current-change":e.handlePageChange}})],1)]),t("el-dialog",{attrs:{title:"关注者",visible:e.followersDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.followersDialogVisible=t}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingFollowers,expression:"loadingFollowers"}]},[e.followersList.length>0?t("div",{staticClass:"user-list"},e._l(e.followersList,(function(s){return t("div",{key:s._id,staticClass:"user-list-item",on:{click:function(t){return e.navigateToUser(s._id)}}},[t("div",{staticClass:"user-avatar"},[t("img",{attrs:{src:e.getImageUrl(s.avatar,"UserImg")||e.defaultAvatar,alt:s.username}})]),t("div",{staticClass:"user-info"},[t("span",{staticClass:"user-name"},[e._v(e._s(s.username))]),s.bio?t("span",{staticClass:"user-bio"},[e._v(e._s(s.bio))]):e._e()])])})),0):e.loadingFollowers?e._e():t("div",{staticClass:"empty-list"},[e._v(" 暂无关注者 ")])])]),t("el-dialog",{attrs:{title:"关注",visible:e.followingDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.followingDialogVisible=t}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingFollowing,expression:"loadingFollowing"}]},[e.followingList.length>0?t("div",{staticClass:"user-list"},e._l(e.followingList,(function(s){return t("div",{key:s._id,staticClass:"user-list-item",on:{click:function(t){return e.navigateToUser(s._id)}}},[t("div",{staticClass:"user-avatar"},[t("img",{attrs:{src:e.getImageUrl(s.avatar,"UserImg")||e.defaultAvatar,alt:s.username}})]),t("div",{staticClass:"user-info"},[t("span",{staticClass:"user-name"},[e._v(e._s(s.username))]),s.bio?t("span",{staticClass:"user-bio"},[e._v(e._s(s.bio))]):e._e()])])})),0):e.loadingFollowing?e._e():t("div",{staticClass:"empty-list"},[e._v(" 暂无关注 ")])])])],1)},Ge=[],Ye={name:"OtherUser",data(){return{userName:"访问用户",userBio:"这是一段个人简介",userAvatar:"",defaultAvatar:"/UserImg/default-avatar.png",articlesCount:0,followersCount:0,followingCount:0,isFollowing:!1,viewMode:"grid",articles:[],currentPage:1,pageSize:12,totalArticles:0,userInfo:{},userStats:{},activeTab:"articles",loading:!1,followersDialogVisible:!1,followingDialogVisible:!1,followersList:[],followingList:[],loadingFollowers:!1,loadingFollowing:!1}},computed:{...(0,m.L8)(["isLoggedIn","getUser"]),currentUserId(){const e=this.getUser;return e&&e._id?e._id:null},targetUserId(){return this.$route.params.id},isSelfProfile(){return this.currentUserId===this.targetUserId}},created(){this.fetchUserInfo(),this.fetchUserArticles(),this.isLoggedIn&&this.currentUserId&&this.checkFollowStatus()},methods:{async handleFollow(){if(!this.isLoggedIn)return this.$message.warning("请先登录后再关注用户"),void this.$router.push("/login");if(this.isSelfProfile)this.$message.warning("不能关注自己");else{this.loading=!0;try{this.isFollowing?await this.unfollowUser():await this.followUser()}catch(e){console.error("关注操作失败:",e),this.$message.error("操作失败，请稍后再试")}finally{this.loading=!1}}},async followUser(){try{const e=await y.A.post("/api/follow",{followeeId:this.targetUserId},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.data.success)throw new Error(e.data.message||"关注失败");this.isFollowing=!0,this.followersCount++,this.$message.success(`已关注 ${this.userInfo.username}`)}catch(e){throw console.error("关注失败:",e),this.$message.error(e.response?.data?.message||"关注失败，请稍后再试"),e}},async unfollowUser(){try{const e=await y.A.delete("/api/follow",{data:{followeeId:this.targetUserId},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.data.success)throw new Error(e.data.message||"取消关注失败");this.isFollowing=!1,this.followersCount=Math.max(0,this.followersCount-1),this.$message.success(`已取消关注 ${this.userInfo.username}`)}catch(e){throw console.error("取消关注失败:",e),this.$message.error(e.response?.data?.message||"取消关注失败，请稍后再试"),e}},async checkFollowStatus(){if(this.isLoggedIn&&this.currentUserId&&!this.isSelfProfile)try{const e=await y.A.get(`/api/follow/check/${this.targetUserId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});this.isFollowing=e.data.isFollowing,console.log("关注状态:",this.isFollowing)}catch(e){console.error("检查关注状态失败:",e)}},formatDate(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},handlePageChange(e){this.currentPage=e},goBack(){this.$router.go(-1)},getImageUrl(e,t){if(!e)return null;const s=window.location.origin,a="UserImg"===t?`UserImg/${e}`:`uploads/${e}`,i=new URL(a,s);return i.toString()},async fetchUserInfo(){try{const e=this.targetUserId,t=await y.A.get(`/api/public-user-info/${e}`);console.log("用户信息",t.data),this.userInfo=t.data,this.userName=this.userInfo.username||"访问用户",this.userBio=this.userInfo.bio||"这位用户很神秘，暂未设置个人简介",this.userAvatar=this.userInfo.avatar,this.fetchUserStats()}catch(e){console.error("Error fetching user info:",e),this.$message.error("获取用户信息失败")}},async fetchUserStats(){try{const e=await y.A.get(`/api/user-stats/${this.targetUserId}`),t=e.data;this.articlesCount=t.articlesCount||this.articles.length,this.followersCount=t.followersCount||0,this.followingCount=t.followingCount||0,this.userStats={...t,articles:this.articlesCount},console.log("用户统计信息",this.userStats)}catch(e){console.error("获取用户统计信息失败:",e),this.$message.error("获取用户统计信息失败")}},async fetchUserArticles(){try{const e=this.targetUserId,t=await y.A.get(`/api/users/${e}/articles`);this.articles=t.data,console.log("用户文章列表",this.articles)}catch(e){console.error("Error fetching user articles:",e),this.$message.error("获取文章列表失败")}},viewArticle(e){this.$router.push(`/Article/${e}`)},handleSendMessage(){const e=this.$route.params.id;if(!this.$store.getters.isLoggedIn)return this.$message.warning("请先登录后再发送消息"),void this.$router.push("/login");this.$router.push({path:"/messages",query:{createChat:"true",userId:e,userName:this.userInfo.username,userAvatar:this.userInfo.avatar}})},async showFollowers(){if(0!==this.followersCount){this.followersDialogVisible=!0,this.loadingFollowers=!0;try{const e=await y.A.get(`/api/follow/followers/${this.targetUserId}`);this.followersList=e.data}catch(e){console.error("获取关注者列表失败:",e),this.$message.error("获取关注者列表失败")}finally{this.loadingFollowers=!1}}else this.$message.info("暂无关注者")},async showFollowing(){if(0!==this.followingCount){this.followingDialogVisible=!0,this.loadingFollowing=!0;try{const e=await y.A.get(`/api/follow/following/${this.targetUserId}`);this.followingList=e.data}catch(e){console.error("获取关注列表失败:",e),this.$message.error("获取关注列表失败")}finally{this.loadingFollowing=!1}}else this.$message.info("暂无关注")},navigateToUser(e){e===this.currentUserId?this.$router.push("/Index/My"):(this.$router.push(`/user/${e}`),"OtherUser"===this.$route.name&&(this.fetchUserInfo(),this.fetchUserArticles(),this.isLoggedIn&&this.checkFollowStatus()))}}},Ze=Ye,et=(0,u.A)(Ze,Xe,Ge,!1,null,"76d00e43",null),tt=et.exports,st=function(){var e=this,t=e._self._c;return t("div",{staticClass:"messages-page"},[t("div",{staticClass:"header"},[t("button",{staticClass:"back-button",on:{click:e.goBack}},[t("i",{staticClass:"back-icon"},[e._v("←")]),t("span",{staticClass:"back-text"},[e._v("返回")])]),t("span",{staticClass:"separator"},[e._v("/")]),t("span",{staticClass:"title"},[e._v("我的消息")])]),t("div",{staticClass:"messages-container"},[t("div",{staticClass:"message-list-container",class:{"hidden-mobile":e.showChat}},[t("div",{staticClass:"list-header"},[t("h2",[e._v("最近消息")]),e.conversations&&e.conversations.length>0?t("el-dropdown",{on:{command:e.handleCommand}},[t("span",{staticClass:"dropdown-link"},[t("i",{staticClass:"el-icon-more"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"markAllRead"}},[e._v("全部标为已读")]),t("el-dropdown-item",{attrs:{command:"deleteAll"}},[e._v("清空消息")])],1)],1):e._e()],1),t("div",{staticClass:"message-list"},[e._l(e.conversations,(function(s){return t("div",{key:s.id||e.index,staticClass:"message-item",class:{active:e.currentConversation&&e.currentConversation.id===s.id,unread:s.unread},on:{click:function(t){return e.selectConversation(s)}}},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:e.getImageUrl(s.avatar||"640.png","UserImg"),alt:s.name||"未知用户"}}),s.unread&&s.unreadCount?t("span",{staticClass:"unread-badge"},[e._v(e._s(s.unreadCount))]):e._e()]),t("div",{staticClass:"message-info"},[t("div",{staticClass:"message-header"},[t("h3",[e._v(e._s(s.name||"未知用户"))]),t("span",{staticClass:"time"},[e._v(e._s(e.formatTime(s.lastMessageTime)))])]),t("p",{staticClass:"message-preview"},[e._v(e._s(s.lastMessage||"暂无消息"))])])])})),e.conversations&&0!==e.conversations.length?e._e():t("div",{staticClass:"empty-list"},[t("i",{staticClass:"el-icon-message"}),t("p",[e._v("暂无消息")])])],2)]),t("div",{staticClass:"chat-container",class:{"active-mobile":e.showChat}},[e.currentConversation&&e.currentConversation.id?[t("div",{staticClass:"chat-header"},[t("button",{staticClass:"back-to-list",on:{click:e.backToList}},[t("i",{staticClass:"el-icon-arrow-left"})]),t("h2",[e._v(e._s(e.currentConversation.name||"未知用户"))]),e.messages&&e.messages.length>0?t("el-dropdown",[t("span",{staticClass:"dropdown-link"},[t("i",{staticClass:"el-icon-more"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.clearConversation.apply(null,arguments)}}},[e._v("清空聊天记录")])],1)],1):e._e()],1),t("div",{ref:"chatMessages",staticClass:"chat-messages"},[e._l(e.messages,(function(s,a){return[s.isSelf?t("div",{key:s._id||s.id||"self-"+a,staticClass:"message own-message"},[t("div",{staticClass:"message-bubble self-bubble"},[t("div",{staticClass:"message-content"},[e._v(e._s(s.content||""))]),t("div",{staticClass:"message-time"},[e._v(e._s(e.formatTime(s.time)))])]),t("div",{staticClass:"message-avatar self-avatar"},[t("img",{attrs:{src:e.getImageUrl(e.userAvatar||"640.png","UserImg"),alt:"我"}})])]):t("div",{key:s._id||s.id||"other-"+a,staticClass:"message other-message"},[t("div",{staticClass:"message-avatar other-avatar"},[t("img",{attrs:{src:e.getImageUrl(s.senderAvatar||e.currentConversation.avatar||"640.png","UserImg"),alt:s.senderName||e.currentConversation.name||"未知用户"}})]),t("div",{staticClass:"message-bubble other-bubble"},[t("div",{staticClass:"message-content"},[e._v(e._s(s.content||""))]),t("div",{staticClass:"message-time"},[e._v(e._s(e.formatTime(s.time)))])])])]})),e.messages&&0!==e.messages.length?e._e():t("div",{staticClass:"empty-chat"},[t("p",[e._v("没有聊天记录，发送一条消息开始对话吧！")])])],2),t("div",{staticClass:"chat-input"},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"输入消息...",resize:"none"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)}},model:{value:e.messageInput,callback:function(t){e.messageInput=t},expression:"messageInput"}}),t("el-button",{attrs:{type:"primary",disabled:!e.messageInput||!e.messageInput.trim()},on:{click:e.sendMessage}},[e._v(" 发送 ")])],1)]:t("div",{staticClass:"no-conversation"},[t("i",{staticClass:"el-icon-chat-dot-round"}),t("p",[e._v("选择一个对话开始聊天")])])],2)])])},at=[],it={name:"Messages",data(){return{conversations:[],currentConversation:null,messages:[],messageInput:"",showChat:!1,userAvatar:"",loading:!1,totalUnreadCount:0,socket:null,defaultAvatar:s(1575),heartbeatInterval:null,userId:null,isUserInfoValid:!1}},computed:{...(0,m.L8)(["getUser","isLoggedIn","getUserId"]),authHeader(){const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}}},async created(){console.log("Messages组件创建，开始检查用户信息");const e=localStorage.getItem("token");if(!e)return console.warn("未找到token，需要登录"),this.$message.warning("您尚未登录，请先登录"),void this.$router.push("/login");if(await this.validateUserInfo(),this.isUserInfoValid)try{console.log("初始化消息页面"),await this.getUnreadCount(),await this.loadConversations();const e=await this.handleCreateChatRequest();!e&&this.conversations&&this.conversations.length>0?(console.log("没有创建新会话请求，选择第一个会话:",this.conversations[0].id),await this.selectConversation(this.conversations[0])):0===this.conversations.length&&console.log("没有找到任何会话"),this.connectWebSocket(),this.initNotificationListener()}catch(t){console.error("初始化消息页面失败:",t)}},beforeDestroy(){this.disconnectWebSocket()},methods:{goBack(){this.$router.go(-1)},backToList(){this.showChat=!1},async loadConversations(){this.loading=!0;try{if(!this.userId)return console.warn("用户ID无效，无法加载会话"),this.conversations=[],void(this.loading=!1);console.log("开始加载会话列表，用户ID:",this.userId);const t=await y.A.get("/api/conversations",{headers:this.authHeader});if(console.log("会话列表接口返回数据:",t.data),t.data){let s=Array.isArray(t.data)?t.data:[t.data];if(0===s.length)return console.warn("会话列表为空，可能是新用户或后端未返回数据"),void(this.conversations=[]);console.log("找到会话数量:",s.length);const a=[];for(let t=0;t<s.length;t++){const i=s[t],r=i.otherUser||i.participants&&i.participants.find((e=>e._id!==this.userId)),o=r?r.username:"未知用户",n=r?r.avatar:"640.png",l=r?r._id:null;let c="";if(i.lastMessage&&i.lastMessage.content)c=i.lastMessage.content;else if("string"===typeof i.lastMessage)c=i.lastMessage;else try{const e=await this.getConversationMessages(i._id||i.id);if(e&&e.length>0){const t=e[e.length-1];c=t.content||""}}catch(e){console.warn(`无法获取会话 ${i._id||i.id} 的消息:`,e)}console.log(`会话 ${t+1}:`,{id:i._id||i.id,otherUser:o,lastMessage:c,unreadCount:i.unreadCount,participants:i.participants?.map((e=>e._id))}),a.push({id:i._id||i.id||`temp-${Date.now()}-${t}`,name:o,avatar:n,lastMessage:c,lastMessageTime:i.lastMessageTime||i.updatedAt||i.createdAt||new Date,unread:Boolean(i.unread||i.unreadCount>0),unreadCount:i.unreadCount||0,otherUserId:l,participantId:i.participants?.[0]?._id,type:i.type||"private"})}this.conversations=a,console.log("格式化后的会话列表:",this.conversations.map((e=>({id:e.id,name:e.name,lastMessage:e.lastMessage}))))}else this.conversations=[],console.warn("会话列表返回格式不正确:",t.data)}catch(e){console.error("加载消息列表失败:",e),console.error("请求详情:",{url:"/api/conversations",headers:{...this.authHeader,Authorization:this.authHeader.Authorization?this.authHeader.Authorization.substring(0,20)+"...":"none"}}),this.conversations=[],this.$message.error("加载消息列表失败，请检查网络连接"),e.response&&401===e.response.status&&(this.$message.error("登录已过期，请重新登录"),this.$router.push("/login"))}finally{this.loading=!1}},async selectConversation(e){if(e&&e.id){if(this.currentConversation=e,this.showChat=!0,e.unread)try{await y.A.put(`/api/conversations/${e.id}/read`,{},{headers:this.authHeader});const t=e.unreadCount||0;this.totalUnreadCount-=t,this.totalUnreadCount<0&&(this.totalUnreadCount=0),this.$root.$emit("update-unread-count",this.totalUnreadCount),e.unread=!1,e.unreadCount=0}catch(t){console.error("标记消息已读失败:",t)}await this.loadMessages(e.id),this.$nextTick((()=>{this.scrollToBottom()}))}else console.error("无效的会话对象:",e)},async loadMessages(e){if(e)try{if(!this.userId&&(console.warn("未登录或用户ID不可用，但仍然尝试加载消息"),await this.validateUserInfo(),!this.isUserInfoValid))return void this.$message.warning("登录状态可能已失效，请重新登录");console.log("加载会话消息，会话ID:",e,"用户ID:",this.userId);const t=await y.A.get(`/api/conversations/${e}/messages`,{params:{page:1,limit:50,userId:this.userId},headers:this.authHeader});console.log("会话消息接口返回数据:",t.data);let s=[],a=null;t.data&&(t.data.conversation&&(a=t.data.conversation),Array.isArray(t.data.messages)?s=t.data.messages:Array.isArray(t.data)?s=t.data:t.data.data&&Array.isArray(t.data.data.messages)&&(s=t.data.data.messages)),console.log("找到消息数量:",s.length),console.log("会话数据:",a),console.log("消息数据示例:",s.length>0?s[0]:"无消息"),this.userId||console.warn("无法获取当前用户ID，可能影响消息发送者判断"),a&&a.currentUser&&a.otherUser&&(this.currentConversation={...this.currentConversation,name:a.otherUser.username||"未知用户",avatar:a.otherUser.avatar||"640.png",otherUserId:a.otherUser._id,currentUserId:a.currentUser._id});const i=new Set;this.messages=s.map(((e,t)=>{const s=e._id||e.id||`msg-${Date.now()}-${t}`;i.has(s)&&(console.warn(`发现重复消息ID: ${s}，已为其生成新ID`),s=`msg-${Date.now()}-${Math.random().toString(36).substring(2,10)}-${t}`),i.add(s);const a=e.isCurrentUser||"outgoing"===e.direction||e.sender&&e.sender._id===this.userId||e.senderId===this.userId,r=e.sender||{};let o,n,l;return"object"===typeof e.senderId&&null!==e.senderId?(o=e.senderId._id,n=e.senderId.username,l=e.senderId.avatar):(o=e.senderId,n=r.username,l=r.avatar),console.log(`消息 "${e.content?.substring(0,15)}..." 发送者判断:`,{msgId:s,originalId:e._id||e.id,isCurrentUser:e.isCurrentUser,direction:e.direction,senderId:o,senderIdFromObject:r._id,currentUserId:this.userId,isSelf:a,createdAt:e.createdAt}),{id:s,_id:e._id,content:e.content||"",time:e.createdAt||e.time||new Date,isSelf:a,direction:e.direction||(a?"outgoing":"incoming"),sender:r,senderName:n,senderAvatar:l,senderId:o}})),console.log("格式化后的消息列表:",this.messages.slice(0,3).map((e=>({id:e.id,content:e.content?.substring(0,15),isSelf:e.isSelf,direction:e.direction,time:e.time})))),0===this.messages.length&&console.warn("消息列表为空，可能是数据格式问题或后端没有返回数据")}catch(t){console.error("加载消息失败:",t),console.error("请求详情:",{url:`/api/conversations/${e}/messages`,headers:{...this.authHeader,Authorization:this.authHeader.Authorization?this.authHeader.Authorization.substring(0,20)+"...":"none"}}),this.$message.error("加载聊天记录失败，请检查网络连接"),this.messages=[],t.response&&401===t.response.status&&(this.$message.error("登录已过期，请重新登录"),this.$router.push("/login"))}},async sendMessage(){if(!this.messageInput.trim()||!this.currentConversation||!this.currentConversation.id)return;if(!this.userId&&(await this.validateUserInfo(),!this.isUserInfoValid))return void this.$message.warning("无法确认您的身份，请重新登录后再发送消息");const e=this.getUser,t=e?.username||"我",s=e?.avatar||"",a={id:`temp-${Date.now()}`,content:this.messageInput,time:new Date,isSelf:!0,direction:"outgoing",sender:{_id:this.userId,username:t,avatar:s},senderName:t,senderAvatar:s,senderId:this.userId};console.log("发送新消息:",a),this.messages.push(a),this.currentConversation&&(this.currentConversation.lastMessage=this.messageInput,this.currentConversation.lastMessageTime=new Date);const i=this.messageInput;this.messageInput="",this.$nextTick((()=>{this.scrollToBottom()}));try{const e=await y.A.post(`/api/conversations/${this.currentConversation.id}/messages`,{content:i,type:"text",senderId:this.userId},{headers:this.authHeader});if(console.log("消息发送响应:",e.data),e.data){const i=this.messages.findIndex((e=>e.id===a.id));-1!==i&&(this.messages[i]={...e.data,isSelf:!0,direction:"outgoing",senderName:t,senderAvatar:s})}}catch(r){console.error("发送消息失败:",r),this.$message.error("发送消息失败，请检查网络连接"),r.response&&401===r.response.status&&(this.$message.error("登录状态已过期，请重新登录"),this.$router.push("/login"))}},scrollToBottom(){const e=this.$refs.chatMessages;e&&(e.scrollTop=e.scrollHeight)},getImageUrl(e,t="UserImg"){if(!e)return this.defaultAvatar;try{const s=window.location.origin,a=`${t}/${e}`,i=new URL(a,s);return i.toString()}catch(s){return console.error("生成图片URL失败:",s),this.defaultAvatar}},formatTime(e){if(!e)return"";try{const t=new Date,s=new Date(e);if(isNaN(s.getTime()))return"";const a=Math.floor((t-s)/864e5);if(0===a)return s.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});if(1===a)return"昨天 "+s.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});if(a<7){const e=["日","一","二","三","四","五","六"];return"星期"+e[s.getDay()]}return s.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})}catch(t){return console.error("格式化时间失败:",t),""}},handleCommand(e){"markAllRead"===e?this.markAllAsRead():"deleteAll"===e&&this.confirmDeleteAll()},async markAllAsRead(){try{await y.A.put("/api/conversations/read-all",{},{headers:this.authHeader}),this.conversations.forEach((e=>{e.unread=!1,e.unreadCount=0})),this.totalUnreadCount=0,this.$root.$emit("update-unread-count",0),this.$message.success("已将所有消息标记为已读")}catch(e){console.error("标记所有消息已读失败:",e),this.$message.error("操作失败")}},confirmDeleteAll(){this.$confirm("确定要清空所有消息吗？此操作不可恢复。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteAll()})).catch((()=>{}))},async deleteAll(){try{await y.A.delete("/api/conversations",{headers:this.authHeader}),this.conversations=[],this.currentConversation=null,this.messages=[],this.$message.success("已清空所有消息")}catch(e){console.error("删除所有会话失败:",e),this.$message.error("操作失败")}},async clearConversation(){this.currentConversation&&this.$confirm("确定要清空此对话的聊天记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await y.A.delete(`/api/conversations/${this.currentConversation.id}/messages`,{headers:this.authHeader}),this.messages=[],this.$message.success("已清空聊天记录")}catch(e){console.error("清空会话失败:",e),this.$message.error("操作失败")}})).catch((()=>{}))},async getUnreadCount(){try{if(!this.isLoggedIn)return console.warn("用户未登录，跳过获取未读消息数"),0;const e=await y.A.get("/api/conversations/unread-count",{headers:this.authHeader});return e.data&&"number"===typeof e.data.unreadCount?this.totalUnreadCount=e.data.unreadCount:(console.warn("未读消息数返回格式不正确:",e.data),this.totalUnreadCount=0),console.log("当前未读消息总数:",this.totalUnreadCount),this.$root.$emit("update-unread-count",this.totalUnreadCount),this.totalUnreadCount}catch(e){return console.error("获取未读消息数失败:",e),this.totalUnreadCount=0,this.$root.$emit("update-unread-count",0),e.response&&401===e.response.status&&(this.$message.error("登录已过期，请重新登录"),this.$router.push("/login")),0}},async createNewConversation(e,t=""){try{console.log("开始创建新会话，对方用户ID:",e);const s=this.getUser,a=await y.A.post("/api/conversations",{recipientId:e,initialMessage:t},{headers:this.authHeader});console.log("创建会话接口返回数据:",a.data);let i=null;if(a.data&&a.data.data)i=a.data.data;else{if(!a.data)return console.warn("创建会话返回格式不正确:",a.data),null;i=a.data}const r=i.otherUser||i.participants&&i.participants.find((e=>e._id!==s?._id));console.log("找到对方用户:",r);const o={id:i._id||i.id,name:r?.username||"未知用户",avatar:r?.avatar||"640.png",lastMessage:t||i.lastMessage?.content||"",lastMessageTime:i.lastMessageTime||i.updatedAt||i.createdAt||new Date,unread:!1,unreadCount:0,otherUserId:r?._id,participantId:r?._id,type:i.type||"private"};return console.log("格式化后的新会话:",o),this.conversations.unshift(o),await this.selectConversation(o),o}catch(s){return console.error("创建新会话失败:",s),console.error("请求详情:",{url:"/api/conversations",body:{recipientId:e},headers:{...this.authHeader,Authorization:this.authHeader.Authorization?this.authHeader.Authorization.substring(0,20)+"...":"none"}}),this.$message.error("创建新会话失败，请稍后再试"),null}},connectWebSocket(){try{const e=localStorage.getItem("token");if(!e)return void console.warn("未找到用户token，无法连接WebSocket");if(!this.userId)return void console.warn("用户ID不存在，跳过WebSocket连接");const t="https:"===window.location.protocol?"wss:":"ws:",s=window.location.host,a=`${t}//${s}/api/ws?token=${e}&userId=${this.userId}`;console.log("正在连接WebSocket服务器:",a.replace(e,"TOKEN_HIDDEN")),this.socket=new WebSocket(a),this.socket.onopen=()=>{console.log("WebSocket连接已建立"),this.sendHeartbeat(),this.$message.success({message:"实时消息连接已建立",duration:3e3})},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);console.log("收到WebSocket消息:",t),"message"===t.type?this.handleNewMessage(t.message):"unread_count"===t.type?this.updateUnreadCount(t.count):t.type}catch(t){console.error("处理WebSocket消息失败:",t)}},this.socket.onclose=e=>{console.log("WebSocket连接已关闭:",e.code,e.reason),1e3!==e.code&&(console.log("将在30秒后尝试重新连接..."),setTimeout((()=>this.connectWebSocket()),3e4))},this.socket.onerror=e=>{console.error("WebSocket连接错误:",e),this.$message.warning({message:"WebSocket连接失败，实时消息功能可能不可用",duration:5e3})}}catch(e){console.error("初始化WebSocket失败:",e)}},disconnectWebSocket(){this.socket&&this.socket.readyState===WebSocket.OPEN&&(console.log("关闭WebSocket连接"),this.socket.close()),this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)},sendHeartbeat(){this.heartbeatInterval=setInterval((()=>{this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({type:"ping"}))}),3e4)},initNotificationListener(){this.$root.$on("update-unread-count",(e=>{console.log("收到未读消息计数更新:",e),this.totalUnreadCount=e})),Notification&&"Notification"in window&&(console.log("浏览器支持通知API"),"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission())},async handleNewMessage(e){if(console.log("处理新消息:",e),!e||!e.content)return void console.warn("收到无效消息");const t=this.currentConversation&&(e.conversationId===this.currentConversation.id||e.conversation===this.currentConversation.id);if(t&&this.showChat){const t=this.getUser,s=e.senderId===this.userId||e.isCurrentUser,a={id:e._id||e.id||`msg-${Date.now()}-${Math.random()}`,content:e.content,time:e.createdAt||new Date,isSelf:s,senderName:s?t?.username:this.currentConversation.name,senderAvatar:s?t?.avatar:this.currentConversation.avatar,senderId:e.senderId};this.messages.push(a),this.$nextTick((()=>{this.scrollToBottom()})),this.markConversationAsRead(e.conversationId||e.conversation)}else await this.updateConversationWithNewMessage(e),this.showMessageNotification(e);await this.getUnreadCount()},async updateConversationWithNewMessage(e){const t=e.conversationId||e.conversation;if(!t)return;const s=this.conversations.findIndex((e=>e.id===t));if(-1!==s){const t=this.conversations[s];if(t.lastMessage=e.content,t.lastMessageTime=e.createdAt||new Date,t.unread=!0,t.unreadCount=(t.unreadCount||0)+1,s>0){const e=this.conversations.splice(s,1)[0];this.conversations.unshift(e)}}else await this.loadConversations()},async markConversationAsRead(e){if(e)try{await y.A.put(`/api/conversations/${e}/read`,{},{headers:this.authHeader});const t=this.conversations.find((t=>t.id===e));if(t){const e=t.unreadCount||0;this.totalUnreadCount-=e,this.totalUnreadCount<0&&(this.totalUnreadCount=0),t.unread=!1,t.unreadCount=0,this.$root.$emit("update-unread-count",this.totalUnreadCount)}}catch(t){console.error("标记会话已读失败:",t)}},showMessageNotification(e){if(!e)return;let t="新消息";if(e.sender&&e.sender.username)t=e.sender.username;else{const s=this.conversations.find((t=>t.id===(e.conversationId||e.conversation)));s&&(t=s.name)}if(this.$notify({title:t,message:e.content,type:"success",position:"top-right",duration:5e3,onClick:()=>{const t=e.conversationId||e.conversation,s=this.conversations.find((e=>e.id===t));s&&this.selectConversation(s)}}),Notification&&"granted"===Notification.permission&&document.hidden){const s=new Notification(t,{body:e.content,icon:"/favicon.ico"});s.onclick=()=>{window.focus();const t=e.conversationId||e.conversation,s=this.conversations.find((e=>e.id===t));s&&this.selectConversation(s)}}},updateUnreadCount(e){"number"===typeof e&&(this.totalUnreadCount=e,this.$root.$emit("update-unread-count",e),console.log("未读消息数更新为:",e))},async handleCreateChatRequest(){const{createChat:e,userId:t,userName:s,userAvatar:a}=this.$route.query;if("true"===e&&t){console.log("检测到创建聊天请求，目标用户ID:",t);try{if(!this.userId)return console.warn("当前用户ID无效，无法创建新会话"),this.$message.warning("无法创建新会话，请刷新页面或重新登录"),!1;const e=this.conversations.find((e=>e.otherUserId===t||e.participantId===t));if(e)console.log("找到已存在的会话:",e),await this.selectConversation(e);else{console.log("没有找到已存在的会话，创建新会话"),this.$message.info("正在创建新会话...");const e=await this.createNewConversation(t);this.$router.replace({path:"/messages"}),e?(await this.selectConversation(e),this.$message.success("会话已创建，可以开始聊天了！")):this.$message.error("无法创建新会话，请稍后再试")}return!0}catch(i){return console.error("创建会话失败:",i),this.$message.error("无法创建新会话，请稍后再试"),!1}}return!1},async getConversationMessages(e){if(!e)return console.error("无效的会话ID"),[];try{const t=await y.A.get(`/api/conversations/${e}/messages`,{params:{page:1,limit:50},headers:this.authHeader});console.log(`获取会话 ${e} 的消息:`,t.data);let s=[];return t.data&&Array.isArray(t.data.messages)?s=t.data.messages:Array.isArray(t.data)?s=t.data:t.data.data&&Array.isArray(t.data.data.messages)&&(s=t.data.data.messages),s}catch(t){return console.error(`获取会话 ${e} 的消息失败:`,t),[]}},async validateUserInfo(){console.log("验证用户信息...");try{const t=localStorage.getItem("userDetails");let s=null;if(t)try{s=JSON.parse(t),console.log("从localStorage中获取到用户信息:",s)}catch(e){console.error("解析localStorage中的用户信息失败:",e)}if(s&&s._id)return this.userId=s._id,this.userAvatar=s.avatar||"",console.log("使用localStorage中的用户ID:",this.userId),this.isUserInfoValid=!0,!0;const a=this.getUser;if(a&&a._id)return this.userId=a._id,this.userAvatar=a.avatar||"",console.log("使用Vuex中的用户ID:",this.userId),this.isUserInfoValid=!0,!0;console.log("尝试通过API获取用户信息...");const i=localStorage.getItem("token");if(i){const e=await y.A.get("/api/user",{headers:{Authorization:`Bearer ${i}`}});if(e.data&&e.data._id)return this.userId=e.data._id,this.userAvatar=e.data.avatar||"",this.$store.commit("setUser",{token:i,details:e.data}),console.log("通过API获取到用户ID:",this.userId),this.isUserInfoValid=!0,!0}return console.warn("无法获取有效的用户信息，需要重新登录"),this.$message.warning("无法获取您的用户信息，请重新登录"),this.$router.push("/login"),this.isUserInfoValid=!1,!1}catch(t){return console.error("验证用户信息失败:",t),t.response&&401===t.response.status?(localStorage.removeItem("token"),localStorage.removeItem("userDetails"),this.$message.error("登录状态已过期，请重新登录"),this.$router.push("/login")):this.$message.error("验证用户信息时出错，请刷新页面重试"),this.isUserInfoValid=!1,!1}}},mounted(){if(!this.userId&&this.isUserInfoValid){const e=this.getUser;e&&e._id?(this.userId=e._id,this.userAvatar=e.avatar||"",console.log("mounted: 用户ID设置为",this.userId)):this.validateUserInfo().then((e=>{e||console.warn("mounted: 无法获取有效的用户信息")}))}}},rt=it,ot=(0,u.A)(rt,st,at,!1,null,"1848366a",null),nt=ot.exports,lt=s(7966);function ct(){const e=localStorage.getItem("token");if(!e)return!0;try{const t=(0,lt.s)(e),s=Math.floor(Date.now()/1e3);return t.exp<s}catch(t){return console.error("Token decoding failed:",t),!0}}w["default"].use(S()),w["default"].use(Ee.Ay);const dt=[{path:"/",redirect:"/Index"},{path:"/Index",component:K,name:"Index",meta:{requiresAuth:!0},children:[{path:"",redirect:"home"},{path:"home",component:Le,name:"Home",meta:{requiresAuth:!0}},{path:"discover",component:Te,name:"Discover",meta:{requiresAuth:!0}},{path:"my",component:Je,name:"User",meta:{requiresAuth:!0}}]},{path:"/Login",component:Ie,name:"Login"},{path:"/Article/:id",name:"Article",component:Re,meta:{requiresAuth:!0}},{path:"/user/:id",name:"OtherUser",component:tt,meta:{requiresAuth:!0}},{path:"/messages",name:"Messages",component:nt,meta:{requiresAuth:!0}}],ut=new Ee.Ay({mode:"history",routes:dt});ut.beforeEach(((e,t,s)=>{"Article"===e.name&&localStorage.setItem("articleFrom",t.fullPath),s()})),ut.beforeEach(((e,t,s)=>{const a=localStorage.getItem("token");e.matched.some((e=>e.meta.requiresAuth))&&(!a||ct())?(_.Notification.error({title:"登录信息已失效",message:"请从新登录",duration:3e3}),localStorage.removeItem("token"),s("/Login")):s()}));var ht=ut,gt=s(8731),mt=s.n(gt),pt=s(7187),vt=s.n(pt),ft=(s(9432),s(2106)),Ct=s(7080),wt=s(5307);window.$=window.jQuery=i();const yt=new(vt()),bt={apiKey:"AIzaSyDqbqz4CpsCTDY0VbWPQB-t6uHdEIQk2TQ",authDomain:"myblog-c17a0.firebaseapp.com",databaseURL:"https://myblog-c17a0-default-rtdb.firebaseio.com",projectId:"myblog-c17a0",storageBucket:"myblog-c17a0.appspot.com",messagingSenderId:"710118595739",appId:"1:710118595739:web:84343f79d7ad946326ba3e",measurementId:"G-RXB7NMBMLE"},At=(0,ft.Wp)(bt),It=(0,Ct.xI)(At),kt=(0,wt.C3)(At),_t=localStorage.getItem("token");_t&&(A.dispatch("updateUser",{token:_t,details:{}}),y.A.get("/api/users",{headers:{Authorization:`Bearer ${_t}`}}).then((e=>{const t=e.data;A.dispatch("updateUser",{token:_t,details:t})})).catch((e=>{console.error("Fetch user details error:",e)}))),w["default"].prototype.$firebaseApp=At,w["default"].prototype.$auth=It,w["default"].prototype.$database=kt;const St=new w["default"]({router:ht,vuetify:yt,store:A,data:{$firebaseAuth:It},render:e=>e(C)});w["default"].component("VueCal",mt()),w["default"].config.productionTip=!1,w["default"].use(S()),w["default"].use(k()),St.$mount("#app")},9123:function(e,t,s){e.exports=s.p+"img/1.80955ccd.jpg"},3060:function(e,t,s){e.exports=s.p+"img/2.470bd5d7.jpg"},1575:function(e){e.exports="data:image/png;base64,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"},3153:function(e,t,s){e.exports=s.p+"img/logo.0f30f6e6.png"}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,a,i,r){if(!a){var o=1/0;for(d=0;d<e.length;d++){a=e[d][0],i=e[d][1],r=e[d][2];for(var n=!0,l=0;l<a.length;l++)(!1&r||o>=r)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(n=!1,r<o&&(o=r));if(n){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,i,r]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){s.p="/"}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,r,o=a[0],n=a[1],l=a[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(i in n)s.o(n,i)&&(s.m[i]=n[i]);if(l)var d=l(s)}for(t&&t(a);c<o.length;c++)r=o[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},a=self["webpackChunknewcxdblog"]=self["webpackChunknewcxdblog"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(5555)}));a=s.O(a)})();
//# sourceMappingURL=app.7828aef5.js.map